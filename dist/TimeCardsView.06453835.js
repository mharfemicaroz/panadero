import{aa as H,a as _,s as $,b as n,c as C,e as g,f,h as r,v as q,t as b,m as T,i as e,l as u,B as d,L as x,F as V,x as B,C as L,S as I}from"./index.a2c9f28c.js";import{_ as G}from"./LayoutAuthenticatedX.d58fd7d8.js";import{_ as J}from"./SectionMain.8435c1f0.js";import{_ as K}from"./NotificationBar.caa84e93.js";import{B as W}from"./BaseTable.a063d648.js";import{_ as X}from"./CardBox.25a3dc7a.js";import{_ as Z}from"./SectionTitleLineWithButton.39476921.js";import{_ as D}from"./BaseButton.b8e12a74.js";import{p as ee,c as te,u as oe,v as le}from"./mdi.aa269c9f.js";import{u as ae}from"./timeLogStore.e7f94471.js";import{u as se}from"./employeeStore.497070e0.js";import"./darkMode.b88882a1.js";import"./BaseIcon.ad3a4017.js";import"./FormControl.2759acc3.js";import"./FooterBar.948c11c8.js";import"./logo.c6f18b48.js";import"./BaseLevel.e0eed931.js";import"./TableCheckboxCell.8ab5003b.js";import"./BaseButtons.e7208c74.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./index.0363223d.js";const ie={class:"flex items-center gap-2"},ne={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},re={class:"bg-white p-6 rounded shadow-lg w-[600px]"},de=e("h2",{class:"text-xl mb-4"},"Add Time Log",-1),me={class:"grid grid-cols-2 gap-4"},ue={class:"col-span-2"},ce=e("label",{class:"block mb-1"},"Employee",-1),pe=e("option",{value:"",disabled:""},"Select Employee",-1),_e=["value"],ge=e("label",{class:"block mb-1"},"Type",-1),fe=e("option",{value:"time_in"},"Time In",-1),be=e("option",{value:"time_out"},"Time Out",-1),ve=[fe,be],ye=e("label",{class:"block mb-1"},"Log Time",-1),he={class:"col-span-2"},ke=e("label",{class:"block mb-1"},"Remarks",-1),we={class:"flex justify-end space-x-2 mt-4"},Te={key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},xe={class:"bg-white p-6 rounded shadow-lg w-[600px]"},Le=e("h2",{class:"text-xl mb-4"},"Edit Time Log",-1),Ce={class:"grid grid-cols-2 gap-4"},Se={class:"col-span-2"},$e=e("label",{class:"block mb-1"},"Employee",-1),Ve=e("option",{value:"",disabled:""},"Select Employee",-1),Be=["value"],Ie=e("label",{class:"block mb-1"},"Type",-1),De=e("option",{value:"time_in"},"Time In",-1),Ee=e("option",{value:"time_out"},"Time Out",-1),Ue=[De,Ee],Ne=e("label",{class:"block mb-1"},"Log Time",-1),Me={class:"col-span-2"},Pe=e("label",{class:"block mb-1"},"Remarks",-1),Fe={class:"flex justify-end space-x-2 mt-4"},nt={__name:"TimeCardsView",setup(je){const{appContext:E}=H();E.config.globalProperties.API_URL;const v=_(!1),y=_(!1),i=_({employee_id:null,type:"time_in",log_time:"",remarks:""}),s=_({id:null,employee_id:null,type:"time_in",log_time:"",remarks:""}),a=ae(),h=se(),c=_([]);async function p(l={},t=!1){await a.fetchItems(l,t)}p({page:1,limit:10});const U=$(()=>{var l,t,o,k,w;return{total:((l=a.items)==null?void 0:l.total)||0,totalPages:((t=a.items)==null?void 0:t.totalPages)||1,currentPage:((o=a.items)==null?void 0:o.currentPage)||1,pageSize:((k=a.items)==null?void 0:k.pageSize)||10,data:(((w=a.items)==null?void 0:w.data)||[]).map(m=>({...m,employee_name:m.employee?`${m.employee.first_name} ${m.employee.last_name}`:m.employee_id}))}}),S=$({get(){if(!s.value.log_time)return"";const l=new Date(s.value.log_time),t=Y=>Y.toString().padStart(2,"0"),o=l.getFullYear(),k=t(l.getMonth()+1),w=t(l.getDate()),m=t(l.getHours()),z=t(l.getMinutes()),Q=t(l.getSeconds());return`${o}-${k}-${w}T${m}:${z}:${Q}`},set(l){const t=new Date(l);s.value.log_time=t.toISOString()}}),N=[{key:"employee_name",label:"Employee",sortable:!1,filterable:!1},{key:"type",label:"Type",sortable:!0,filterable:!0},{key:"log_time",label:"Log Time",sortable:!0,filterable:!0},{key:"remarks",label:"Remarks",sortable:!1,filterable:!1}],M=async l=>{await p(l,!0)},P=l=>{c.value=l},F=async l=>{a.isLoading=!0,await h.fetchItems({page:1,limit:100},!0),s.value={id:l.id,employee_id:l.employee_id,type:l.type,log_time:l.log_time,remarks:l.remarks},y.value=!0,a.isLoading=!1},j=async()=>{a.isLoading=!0,await h.fetchItems({page:1,limit:100},!0),i.value={employee_id:null,type:"time_in",log_time:"",remarks:""},v.value=!0,a.isLoading=!1};async function A(){await a.createItem(i.value),a.error||(v.value=!1,await p({page:1,limit:10},!0))}async function R(){await a.updateItem(s.value.id,s.value),a.error||(y.value=!1,await p({page:1,limit:10},!0))}async function O(){if(c.value.length===0)return;if((await I.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete them!"})).isConfirmed){for(const t of c.value)if(await a.deleteItem(t),a.error)break;a.error||(c.value=[],await p({page:1,limit:10},!0),I.fire("Deleted!","The time logs have been deleted.","success"))}}return(l,t)=>(n(),C(G,null,{default:g(()=>[f(J,null,{default:g(()=>[r(a).error?(n(),C(K,{key:0,icon:r(ee),color:"danger"},{default:g(()=>[q(b(r(a).error),1)]),_:1},8,["icon"])):T("",!0),f(Z,{icon:r(te),title:"Time Logs",main:""},{default:g(()=>[e("div",ie,[f(D,{icon:r(oe),color:"primary",label:"New Time Log",onClick:j},null,8,["icon"]),c.value.length?(n(),C(D,{key:0,icon:r(le),color:"danger",label:"Delete",onClick:O},null,8,["icon"])):T("",!0)])]),_:1},8,["icon"]),f(X,{class:"mb-6"},{default:g(()=>[f(W,{columns:N,data:U.value,loading:r(a).isLoading,checkable:"",onQueryChange:M,onSelected:P,onEdit:F},null,8,["data","loading"])]),_:1})]),_:1}),v.value?(n(),u("div",ne,[e("div",re,[de,e("div",me,[e("div",ue,[ce,d(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.value.employee_id=o),class:"w-full border p-2 rounded"},[pe,(n(!0),u(V,null,B(r(h).items.data,o=>(n(),u("option",{key:o.id,value:o.id},b(o.first_name)+" "+b(o.last_name),9,_e))),128))],512),[[x,i.value.employee_id]])]),e("div",null,[ge,d(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>i.value.type=o),class:"w-full border p-2 rounded"},ve,512),[[x,i.value.type]])]),e("div",null,[ye,d(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>i.value.log_time=o),type:"datetime-local",class:"w-full border p-2 rounded"},null,512),[[L,i.value.log_time]])]),e("div",he,[ke,d(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>i.value.remarks=o),class:"w-full border p-2 rounded"},null,512),[[L,i.value.remarks]])])]),e("div",we,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[4]||(t[4]=o=>v.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:A}," Save ")])])])):T("",!0),y.value?(n(),u("div",Te,[e("div",xe,[Le,e("div",Ce,[e("div",Se,[$e,d(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.value.employee_id=o),class:"w-full border p-2 rounded"},[Ve,(n(!0),u(V,null,B(r(h).items.data,o=>(n(),u("option",{key:o.id,value:o.id},b(o.first_name)+" "+b(o.last_name),9,Be))),128))],512),[[x,s.value.employee_id]])]),e("div",null,[Ie,d(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.value.type=o),class:"w-full border p-2 rounded"},Ue,512),[[x,s.value.type]])]),e("div",null,[Ne,d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>S.value=o),type:"datetime-local",class:"w-full border p-2 rounded"},null,512),[[L,S.value]])]),e("div",Me,[Pe,d(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.value.remarks=o),class:"w-full border p-2 rounded"},null,512),[[L,s.value.remarks]])])]),e("div",Fe,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[9]||(t[9]=o=>y.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:R}," Update ")])])])):T("",!0)]),_:1}))}};export{nt as default};
