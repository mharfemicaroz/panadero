import{J as b,K as de,a as y,aa as ce,q as ue,s as pe,b as v,c as V,e as N,h as m,v as _e,t as c,m as w,f as x,i as e,l as D,B as Y,L as U,F as W,x as Q,C as me,S as R}from"./index.51562f92.js";import{_ as ye}from"./LayoutAuthenticatedX.6bd79e57.js";import{_ as fe}from"./NotificationBar.041f3c84.js";import{B as ve}from"./BaseTable.7226d914.js";import{_ as he}from"./CardBox.fbcc1594.js";import{_ as ge}from"./SectionTitleLineWithButton.887bdad5.js";import{_ as M}from"./BaseButton.ef1be83b.js";import{V as z}from"./main.dda56ee5.js";import{p as be,u as we,v as xe,c as ke,y as Pe,h as De,ax as Se,ay as Ce}from"./mdi.50c7bbe5.js";import{A as k}from"./index.e54bd547.js";import{u as $e}from"./employeeStore.bed0db31.js";import"./darkMode.dac3c9ce.js";import"./BaseIcon.dfc7d1db.js";import"./FormControl.1af19c3b.js";import"./FooterBar.d9b5343e.js";import"./logo.c6f18b48.js";import"./BaseLevel.135e0538.js";import"./TableCheckboxCell.cdb4ab34.js";import"./BaseButtons.a7fb044c.js";import"./_plugin-vue_export-helper.c27b6911.js";const S={async create(n){return(await b.post(`${k}/payrolls`,n)).data},async getById(n){return(await b.get(`${k}/payrolls/${n}`)).data},async updateById(n,i){return(await b.put(`${k}/payrolls/${n}`,i)).data},async delete(n){return(await b.delete(`${k}/payrolls/${n}`)).data},async list(n){return(await b.get(`${k}/payrolls`,{params:n})).data},async calculatePayroll(n){return(await b.post(`${k}/payrolls/calculate`,n)).data},async generatePayroll(n){return(await b.post(`${k}/payrolls/generate`,n)).data},async approvePayroll(n){return(await b.post(`${k}/payrolls/${n}/approve`)).data},async markAsPaid(n,i){return(await b.post(`${k}/payrolls/${n}/mark-paid`,i)).data}},Me=de("payroll",()=>{const n=y({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),i=y(!1),s=y(null),g=y(!1);return{items:n,isLoading:i,error:s,isLoaded:g,fetchItems:async(r={},u=!1)=>{var l;if(s.value=null,!(!u&&g.value))try{i.value=!0;const d=await S.list(r);Object.assign(n.value,{total:d.total||0,totalPages:d.totalPages||1,currentPage:r.page||1,pageSize:r.limit||10,data:d.data||[]}),g.value=!0}catch(d){s.value=((l=d==null?void 0:d.response)==null?void 0:l.message)||"Failed to fetch payroll records"}finally{i.value=!1}},createItem:async r=>{var u;s.value=null;try{i.value=!0;const l=await S.create(r);n.value.data.push(l),n.value.total+=1}catch(l){s.value=((u=l==null?void 0:l.response)==null?void 0:u.message)||"Failed to create payroll record"}finally{i.value=!1}},updateItem:async(r,u)=>{var l;s.value=null;try{i.value=!0;const d=await S.updateById(r,u),f=n.value.data.findIndex($=>$.id===r);f!==-1&&(n.value.data[f]=d)}catch(d){s.value=((l=d==null?void 0:d.response)==null?void 0:l.message)||"Failed to update payroll record"}finally{i.value=!1}},deleteItem:async r=>{var u;s.value=null;try{i.value=!0,await S.delete(r),n.value.data=n.value.data.filter(l=>l.id!==r),n.value.total-=1}catch(l){s.value=((u=l==null?void 0:l.response)==null?void 0:u.message)||"Failed to delete payroll record"}finally{i.value=!1}},calculatePayroll:async r=>{var u;s.value=null;try{return i.value=!0,await S.calculatePayroll(r)}catch(l){s.value=((u=l==null?void 0:l.response)==null?void 0:u.message)||"Failed to calculate payroll"}finally{i.value=!1}},generatePayroll:async r=>{var u;s.value=null;try{return i.value=!0,await S.generatePayroll(r)}catch(l){s.value=((u=l==null?void 0:l.response)==null?void 0:u.message)||"Failed to generate payroll"}finally{i.value=!1}},approvePayroll:async r=>{var u;s.value=null;try{i.value=!0;const l=await S.approvePayroll(r),d=n.value.data.findIndex(f=>f.id===r);d!==-1&&(n.value.data[d]=l)}catch(l){s.value=((u=l==null?void 0:l.response)==null?void 0:u.message)||"Failed to approve payroll"}finally{i.value=!1}},markAsPaid:async(r,u)=>{var l;s.value=null;try{i.value=!0;const d=await S.markAsPaid(r,u),f=n.value.data.findIndex($=>$.id===r);f!==-1&&(n.value.data[f]=d)}catch(d){s.value=((l=d==null?void 0:d.response)==null?void 0:l.message)||"Failed to mark payroll as paid"}finally{i.value=!1}},resetStore:()=>{n.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},g.value=!1,i.value=!1,s.value=null}}}),je={class:"flex items-center gap-2"},Fe={class:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded shadow-sm"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve=e("label",{class:"block text-sm font-medium text-gray-700"},"Select Payroll Date Range",-1),Ae={class:"mt-4 flex justify-end"},Be={class:"flex gap-2"},Te={key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},Ee={class:"bg-white p-6 rounded shadow-lg w-[600px]"},Ne=e("h2",{class:"text-xl mb-4"},"Generate Payroll",-1),Ye={class:"grid grid-cols-2 gap-4"},Re={class:"col-span-2"},Ue=e("label",{class:"block mb-1"},"Employee",-1),ze=e("option",{value:"",disabled:""},"Select Employee",-1),Le=["value"],He={class:"col-span-2"},Oe=e("label",{class:"block mb-1"},"Select Date Range",-1),Ge={class:"flex justify-end space-x-2 mt-4"},We={key:2,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},Qe={class:"bg-white p-6 rounded shadow-lg w-[600px]"},Je=e("h2",{class:"text-xl mb-4"},"Edit Payroll",-1),Ke={class:"grid grid-cols-2 gap-4"},Xe={class:"col-span-2"},Ze=e("label",{class:"block mb-1"},"Employee",-1),qe=e("option",{value:"",disabled:""},"Select Employee",-1),et=["value"],tt={class:"col-span-2"},at=e("label",{class:"block mb-1"},"Select Date Range",-1),st={class:"flex justify-end space-x-2 mt-4"},lt={key:3,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},ot={class:"bg-white p-6 rounded shadow-lg w-[400px]"},nt=e("h2",{class:"text-xl mb-4"},"Mark as Paid",-1),it={class:"grid grid-cols-1 gap-4"},rt=e("label",{class:"block mb-1"},"Payment Method",-1),dt=e("option",{value:"bank_transfer"},"Bank Transfer",-1),ct=e("option",{value:"cash"},"Cash",-1),ut=e("option",{value:"check"},"Check",-1),pt=[dt,ct,ut],_t=e("label",{class:"block mb-1"},"Remarks",-1),mt={class:"flex justify-end space-x-2 mt-4"},yt={key:4,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 overflow-auto"},ft={class:"bg-white p-6 rounded shadow-lg w-[600px] max-h-full overflow-auto"},vt=e("h2",{class:"text-xl font-semibold mb-4"},"Payroll Details",-1),ht={class:"grid grid-cols-2 gap-4 border-b pb-4"},gt={class:"flex justify-between"},bt=e("span",{class:"font-medium"},"Employee:",-1),wt={class:"flex justify-between"},xt=e("span",{class:"font-medium"},"Payroll Date:",-1),kt={class:"flex justify-between"},Pt=e("span",{class:"font-medium"},"Start Date:",-1),Dt={class:"flex justify-between"},St=e("span",{class:"font-medium"},"End Date:",-1),Ct={class:"flex justify-between"},$t=e("span",{class:"font-medium"},"Status:",-1),Mt={class:"flex justify-between"},jt=e("span",{class:"font-medium"},"Active:",-1),Ft={class:"mt-4 grid grid-cols-2 gap-4"},It={class:"flex flex-col gap-2"},Vt={class:"flex justify-between"},At=e("span",{class:"font-medium"},"Basic Salary:",-1),Bt={class:"flex justify-between"},Tt=e("span",{class:"font-medium"},"Gross Salary:",-1),Et={class:"flex justify-between"},Nt=e("span",{class:"font-medium"},"Net Salary:",-1),Yt={class:"flex flex-col gap-2"},Rt={class:"flex justify-between"},Ut=e("span",{class:"font-medium"},"Payment Method:",-1),zt={class:"flex justify-between"},Lt=e("span",{class:"font-medium"},"Remarks:",-1),Ht={class:"mt-4"},Ot=e("h3",{class:"text-lg font-medium mb-2"},"Work & Pay Metrics",-1),Gt={class:"grid grid-cols-2 gap-4"},Wt={class:"flex flex-col gap-2"},Qt={class:"flex justify-between"},Jt=e("span",{class:"font-medium"},"Total Days Worked:",-1),Kt={class:"flex justify-between"},Xt=e("span",{class:"font-medium"},"Total Hours Worked:",-1),Zt={class:"flex justify-between"},qt=e("span",{class:"font-medium"},"Overtime Hours:",-1),ea={class:"flex justify-between"},ta=e("span",{class:"font-medium"},"Overtime Pay:",-1),aa={class:"flex flex-col gap-2"},sa={class:"flex justify-between"},la=e("span",{class:"font-medium"},"Night Differential Hours:",-1),oa={class:"flex justify-between"},na=e("span",{class:"font-medium"},"Night Differential Pay:",-1),ia={class:"flex justify-between"},ra=e("span",{class:"font-medium"},"Holiday Hours:",-1),da={class:"flex justify-between"},ca=e("span",{class:"font-medium"},"Holiday Pay:",-1),ua={class:"mt-4 grid grid-cols-2 gap-4"},pa={class:"flex justify-between"},_a=e("span",{class:"font-medium"},"Allowances:",-1),ma={class:"flex justify-between"},ya=e("span",{class:"font-medium"},"Deductions:",-1),fa={class:"flex justify-between"},va=e("span",{class:"font-medium"},"Tax Deduction:",-1),ha={class:"flex justify-end mt-4"},Ya={__name:"PayrollsView",setup(n){const{appContext:i}=ce();i.config.globalProperties.API_URL;const s=Me(),g=$e(),j=y([]);g.fetchItems({page:1,limit:100},!0);const _=new Date,L=new Date(_.getFullYear(),_.getMonth(),1),H=new Date(_.getFullYear(),_.getMonth()+1,0),A=y([L,H]);function F(o){const t=new Date(o),a=t.getFullYear(),h=(t.getMonth()+1).toString().padStart(2,"0"),P=t.getDate().toString().padStart(2,"0");return`${a}-${h}-${P}`}const B=y(!1),T=y(!1),C=y({employee_id:null,start_date:"",end_date:"",is_active:!0}),r=y({id:null,employee_id:null,start_date:"",end_date:"",is_active:!0}),u=y([new Date(_.getFullYear(),_.getMonth(),1),new Date(_.getFullYear(),_.getMonth()+1,0)]),l=y([new Date(_.getFullYear(),_.getMonth(),1),new Date(_.getFullYear(),_.getMonth()+1,0)]),d=y(!1),f=y({payroll_id:null,payment_method:"bank_transfer",remarks:""}),$=y(!1),p=y({});async function O(o={},t=!1){await s.fetchItems(o,t)}async function I(){const o=J(A.value[0]),t=K(A.value[1]);await O({"filters[start_date]":o,"filters[end_date]":t,page:1,limit:10},!0)}function J(o){const t=new Date(o),a=t.getFullYear(),h=(t.getMonth()+1).toString().padStart(2,"0"),P=t.getDate().toString().padStart(2,"0");return`${a}-${h}-${P}T00:00:00`}function K(o){const t=new Date(o),a=t.getFullYear(),h=(t.getMonth()+1).toString().padStart(2,"0"),P=t.getDate().toString().padStart(2,"0");return`${a}-${h}-${P}T23:59:59`}ue(()=>{I()});const X=pe(()=>{var o,t,a,h,P;return{total:((o=s.items)==null?void 0:o.total)||0,totalPages:((t=s.items)==null?void 0:t.totalPages)||1,currentPage:((a=s.items)==null?void 0:a.currentPage)||1,pageSize:((h=s.items)==null?void 0:h.pageSize)||10,data:(((P=s.items)==null?void 0:P.data)||[]).map(E=>({...E,employee:E.employee?`${E.employee.first_name} ${E.employee.last_name}`:`Employee ${E.employee_id}`}))}}),Z=[{key:"employee",label:"Employee",sortable:!0,filterable:!0},{key:"payroll_date",label:"Payroll Date",sortable:!0,filterable:!0},{key:"start_date",label:"Start Date",sortable:!0,filterable:!0},{key:"end_date",label:"End Date",sortable:!0,filterable:!0},{key:"basic_salary",label:"Basic Salary",sortable:!0,filterable:!0},{key:"status",label:"Status",sortable:!0,filterable:!0},{key:"payment_method",label:"Payment Method",sortable:!0,filterable:!0}],q=async o=>{await O(o,!0)},ee=o=>{j.value=o},G=async o=>{s.isLoading=!0,r.value={id:o.id,employee_id:o.employee_id,start_date:o.start_date,end_date:o.end_date,is_active:o.is_active},l.value=[new Date(o.start_date),new Date(o.end_date)],T.value=!0,s.isLoading=!1},te=async()=>{await g.fetchItems({page:1,limit:100},!0),C.value={employee_id:null,start_date:"",end_date:"",is_active:!0},u.value=[new Date(_.getFullYear(),_.getMonth(),1),new Date(_.getFullYear(),_.getMonth()+1,0)],B.value=!0};async function ae(){C.value.start_date=F(u.value[0]),C.value.end_date=F(u.value[1]);const o=F(new Date),t={...C.value,payroll_date:o},a=await s.generatePayroll(t);!s.error&&a&&(B.value=!1,await I())}async function se(){r.value.start_date=F(l.value[0]),r.value.end_date=F(l.value[1]),await s.updateItem(r.value.id,r.value),s.error||(T.value=!1,await I())}async function le(){if(j.value.length===0)return;if((await R.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete them!"})).isConfirmed){for(const t of j.value)if(await s.deleteItem(t),s.error)break;s.error||(j.value=[],await I(),R.fire("Deleted!","The payroll records have been deleted.","success"))}}async function oe(o){const t=await s.approvePayroll(o.id);!s.error&&t&&(await I(),R.fire("Approved!","The payroll has been approved.","success"))}function ne(o){f.value={payroll_id:o.id,payment_method:"bank_transfer",remarks:""},d.value=!0}async function ie(){const o=await s.markAsPaid(f.value.payroll_id,f.value);!s.error&&o&&(d.value=!1,await I(),R.fire("Paid!","The payroll has been marked as paid.","success"))}function re(o){p.value=o,$.value=!0}return(o,t)=>(v(),V(ye,null,{default:N(()=>[m(s).error?(v(),V(fe,{key:0,icon:m(be),color:"danger"},{default:N(()=>[_e(c(m(s).error),1)]),_:1},8,["icon"])):w("",!0),x(ge,{icon:m(ke),title:"Payroll",main:""},{default:N(()=>[e("div",je,[x(M,{icon:m(we),color:"primary",label:"Generate Payroll",onClick:te},null,8,["icon"]),j.value.length?(v(),V(M,{key:0,icon:m(xe),color:"danger",label:"Delete",onClick:le},null,8,["icon"])):w("",!0)])]),_:1},8,["icon"]),e("div",Fe,[e("div",Ie,[e("div",null,[Ve,x(m(z),{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=a=>A.value=a),range:"","multi-calendars":"",format:"yyyy-MM-dd","input-class":"mt-1 block w-full rounded border-gray-300 shadow-sm"},null,8,["modelValue"])])]),e("div",Ae,[x(M,{label:"Filter",color:"blue",class:"px-4 py-2",onClick:o.applyFilters},null,8,["onClick"])])]),x(he,{class:"mb-6"},{default:N(()=>[x(ve,{columns:Z,data:X.value,loading:m(s).isLoading,checkable:"",onQueryChange:q,onSelected:ee,onEdit:G},{"cell-actions":N(({row:a})=>[e("div",Be,[a.status==="draft"?(v(),V(M,{key:0,icon:m(Pe),color:"light",size:"small",onClick:h=>G(a)},null,8,["icon","onClick"])):w("",!0),x(M,{icon:m(De),color:"light",size:"small",onClick:h=>re(a)},null,8,["icon","onClick"]),a.status==="draft"?(v(),V(M,{key:1,icon:m(Se),color:"success",size:"small",onClick:h=>oe(a)},null,8,["icon","onClick"])):w("",!0),a.status==="approved"?(v(),V(M,{key:2,icon:m(Ce),color:"danger",size:"small",onClick:h=>ne(a)},null,8,["icon","onClick"])):w("",!0)])]),_:1},8,["data","loading"])]),_:1}),B.value?(v(),D("div",Te,[e("div",Ee,[Ne,e("div",Ye,[e("div",Re,[Ue,Y(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>C.value.employee_id=a),class:"w-full border p-2 rounded"},[ze,(v(!0),D(W,null,Q(m(g).items.data,a=>(v(),D("option",{key:a.id,value:a.id},c(a.first_name)+" "+c(a.last_name),9,Le))),128))],512),[[U,C.value.employee_id,void 0,{number:!0}]])]),e("div",He,[Oe,x(m(z),{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value=a),range:"","multi-calendars":"",format:"yyyy-MM-dd","input-class":"mt-1 block w-full rounded border-gray-300 shadow-sm"},null,8,["modelValue"])])]),e("div",Ge,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[3]||(t[3]=a=>B.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:ae}," Generate ")])])])):w("",!0),T.value?(v(),D("div",We,[e("div",Qe,[Je,e("div",Ke,[e("div",Xe,[Ze,Y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.value.employee_id=a),class:"w-full border p-2 rounded"},[qe,(v(!0),D(W,null,Q(m(g).items.data,a=>(v(),D("option",{key:a.id,value:a.id},c(a.first_name)+" "+c(a.last_name),9,et))),128))],512),[[U,r.value.employee_id,void 0,{number:!0}]])]),e("div",tt,[at,x(m(z),{modelValue:l.value,"onUpdate:modelValue":t[5]||(t[5]=a=>l.value=a),range:"","multi-calendars":"",format:"yyyy-MM-dd","input-class":"mt-1 block w-full rounded border-gray-300 shadow-sm"},null,8,["modelValue"])])]),e("div",st,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[6]||(t[6]=a=>T.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:se}," Update ")])])])):w("",!0),d.value?(v(),D("div",lt,[e("div",ot,[nt,e("div",it,[e("div",null,[rt,Y(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>f.value.payment_method=a),class:"w-full border p-2 rounded"},pt,512),[[U,f.value.payment_method]])]),e("div",null,[_t,Y(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=a=>f.value.remarks=a),class:"w-full border p-2 rounded"},null,512),[[me,f.value.remarks]])])]),e("div",mt,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[9]||(t[9]=a=>d.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:ie}," Confirm ")])])])):w("",!0),$.value?(v(),D("div",yt,[e("div",ft,[vt,e("div",ht,[e("div",gt,[bt,e("span",null,c(p.value.employee||"N/A"),1)]),e("div",wt,[xt,e("span",null,c(p.value.payroll_date),1)]),e("div",kt,[Pt,e("span",null,c(p.value.start_date),1)]),e("div",Dt,[St,e("span",null,c(p.value.end_date),1)]),e("div",Ct,[$t,e("span",null,c(p.value.status),1)]),e("div",Mt,[jt,e("span",null,c(p.value.is_active?"Yes":"No"),1)])]),e("div",Ft,[e("div",It,[e("div",Vt,[At,e("span",null,c(p.value.basic_salary),1)]),e("div",Bt,[Tt,e("span",null,c(p.value.gross_salary),1)]),e("div",Et,[Nt,e("span",null,c(p.value.net_salary),1)])]),e("div",Yt,[e("div",Rt,[Ut,e("span",null,c(p.value.payment_method),1)]),e("div",zt,[Lt,e("span",null,c(p.value.remarks||"N/A"),1)])])]),e("div",Ht,[Ot,e("div",Gt,[e("div",Wt,[e("div",Qt,[Jt,e("span",null,c(p.value.total_days_worked),1)]),e("div",Kt,[Xt,e("span",null,c(p.value.total_hours_worked),1)]),e("div",Zt,[qt,e("span",null,c(p.value.overtime_hours),1)]),e("div",ea,[ta,e("span",null,c(p.value.overtime_pay),1)])]),e("div",aa,[e("div",sa,[la,e("span",null,c(p.value.night_differential_hours),1)]),e("div",oa,[na,e("span",null,c(p.value.night_differential_pay),1)]),e("div",ia,[ra,e("span",null,c(p.value.holiday_hours),1)]),e("div",da,[ca,e("span",null,c(p.value.holiday_pay),1)])])])]),e("div",ua,[e("div",pa,[_a,e("span",null,c(p.value.allowances),1)]),e("div",ma,[ya,e("span",null,c(p.value.deductions),1)]),e("div",fa,[va,e("span",null,c(p.value.tax_deduction),1)])]),e("div",ha,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[10]||(t[10]=a=>$.value=!1)}," Close ")])])])):w("",!0)]),_:1}))}};export{Ya as default};
