import{_ as Q}from"./LayoutAuthenticatedX.b8bb81e8.js";import{_ as T}from"./SectionMain.13d65fb7.js";import{_ as q}from"./SectionTitleLineWithButton.e58ee057.js";import{_ as U}from"./BaseButton.db2641b8.js";import{B as W}from"./BaseTable.4f3dd512.js";import{_ as H}from"./NotificationBar.705d3c1c.js";import{u as J}from"./item.4bada906.js";import{J as w,K,a as v,q as O,s as A,b as m,l as g,f as k,e as I,i as e,F,x as R,m as P,t as f,h as _,c as G,v as L,n as V}from"./index.c3b8df4f.js";import{A as C}from"./index.c4cb3088.js";import{p as X,c as Y,h as Z,w as ee,x as te}from"./mdi.aa269c9f.js";import"./darkMode.be9f2000.js";import"./BaseIcon.7a5ae775.js";import"./FormControl.f0dd7a4c.js";import"./FooterBar.9f5e8a1a.js";import"./logo.c6f18b48.js";import"./BaseLevel.3eae5b81.js";import"./TableCheckboxCell.7896a874.js";import"./BaseButtons.b6e87254.js";import"./_plugin-vue_export-helper.c27b6911.js";const B={async create(s){return(await w.post(`${C}/stockmovements`,s)).data},async getById(s){return(await w.get(`${C}/stockmovements/${s}`)).data},async updateById(s,t){return(await w.put(`${C}/stockmovements/${s}`,t)).data},async delete(s){return(await w.delete(`${C}/stockmovements/${s}`)).data},async list(s){return(await w.get(`${C}/stockmovements`,{params:s})).data}},ae=K("stockMovement",()=>{const s=v({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),t=v(!1),r=v(null),p=v(!1);return{items:s,isLoading:t,error:r,isLoaded:p,fetchItems:async(o={},d=!1)=>{var c,a;if(r.value=null,!(!d&&p.value))try{t.value=!0;const i=await B.list(o);Object.assign(s.value,{total:i.total||0,totalPages:i.totalPages||1,currentPage:o.page||1,pageSize:o.limit||10,data:i.data||[]}),p.value=!0}catch(i){r.value=((a=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:a.message)||"Failed to fetch stock movements"}finally{t.value=!1}},createItem:async o=>{var d,c;r.value=null;try{t.value=!0;const a=await B.create(o);s.value.data.push(a),s.value.total+=1}catch(a){r.value=((c=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to create stock movement"}finally{t.value=!1}},updateItem:async(o,d)=>{var c,a;r.value=null;try{t.value=!0;const i=await B.updateById(o,d),$=s.value.data.findIndex(M=>M.id===o);$!==-1&&(s.value.data[$]=i)}catch(i){r.value=((a=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:a.message)||"Failed to update stock movement"}finally{t.value=!1}},deleteItem:async o=>{var d,c;r.value=null;try{t.value=!0,await B.delete(o),s.value.data=s.value.data.filter(a=>a.id!==o),s.value.total-=1}catch(a){r.value=((c=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to delete stock movement"}finally{t.value=!1}},resetStore:()=>{s.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},p.value=!1,t.value=!1,r.value=null}}}),se={class:"flex items-center gap-2"},oe=["onClick"],le={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},ne=["d"],re={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"},ie={class:"bg-white p-4 rounded shadow-lg w-[800px] max-h-screen overflow-auto"},ce=e("h2",{class:"text-lg font-semibold mb-2"},"Stock Movement Ledger",-1),ue={class:"space-y-2"},de={class:"mr-2"},me=["d"],ve={class:"flex-1 text-xs"},ge={class:"flex justify-between"},pe={class:"font-semibold"},fe={class:"text-gray-500"},_e={class:"mt-1"},ye={class:"ml-2"},he={class:"mt-1"},xe={class:"mt-1"},be={class:"flex justify-between items-center mt-3 text-xs text-gray-600"},we={class:"flex justify-center mt-3"},ke={key:1,class:"text-xs"},Ie={class:"flex justify-end mt-4"},N=5,We={__name:"ItemsLedger",setup(s){const t=J(),r=ae(),p=v(!1),y=v([]),S=v(10),D=v(0),x=v(!1),h=v(null),o=v(1);async function d(n={}){await t.fetchItemsWithHistory(n,!0)}O(()=>{d({page:1,limit:10})});const c=A(()=>({total:t.items.total||0,totalPages:t.items.totalPages||1,currentPage:t.items.currentPage||1,pageSize:t.items.pageSize||10,data:t.items.data||[]})),a=A(()=>{const n=y.value.length,u=Math.ceil(n/N),l=(o.value-1)*N,b=y.value.slice(l,l+N);return{total:n,totalPages:u,currentPage:o.value,pageSize:N,data:b}}),i=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"price",label:"Price",sortable:!0,filterable:!0},{key:"cost",label:"Cost",sortable:!0,filterable:!0},{key:"ledgerCount",label:"Ledger Entries",formatter:(n,u)=>u.history?u.history.length:0}],$=async n=>{await d(n)},M=async n=>{if(h.value=n.inventories&&n.inventories[0]&&n.inventories[0].id||null,!h.value){y.value=[],p.value=!0;return}S.value=10,o.value=1,y.value=[],await z(),p.value=!0},z=async()=>{if(h.value){x.value=!0;try{const n={page:1,limit:S.value,inventory_id:h.value};await r.fetchItems(n,!0),y.value=r.items.data.filter(u=>u.inventory_id===h.value),D.value=r.items.total}catch{}finally{x.value=!1}}},E=async()=>{S.value+=10,await z(),o.value=1},j=n=>{o.value=n};return(n,u)=>(m(),g(F,null,[k(Q,null,{default:I(()=>[k(T,null,{default:I(()=>[_(t).error?(m(),G(H,{key:0,icon:_(X),color:"danger"},{default:I(()=>[L(f(_(t).error),1)]),_:1},8,["icon"])):P("",!0),k(q,{icon:_(Y),title:"Item Ledger",main:""},{default:I(()=>[e("div",se,[k(U,{icon:n.mdiExport,color:"warning",label:"Export Ledger"},null,8,["icon"])])]),_:1},8,["icon"]),k(W,{columns:i,data:c.value,loading:_(t).isLoading,onQueryChange:$},{"cell-actions":I(({row:l})=>[e("button",{class:"text-blue-600 underline",onClick:b=>M(l),title:"View Ledger"},[(m(),g("svg",le,[e("path",{d:_(Z)},null,8,ne)]))],8,oe)]),_:1},8,["data","loading"])]),_:1})]),_:1}),p.value?(m(),g("div",re,[e("div",ie,[ce,e("div",ue,[(m(!0),g(F,null,R(a.value.data,l=>{var b;return m(),g("div",{key:l.id,class:V(["flex items-center p-2 border-l-4 bg-gray-50 shadow-sm",l.type==="IN"?"border-green-500":"border-red-500"])},[e("div",de,[(m(),g("svg",{class:V(["w-6 h-6",l.type==="IN"?"text-green-500":"text-red-500"]),viewBox:"0 0 24 24"},[e("path",{d:l.type==="IN"?_(ee):_(te)},null,8,me)],2))]),e("div",ve,[e("div",ge,[e("span",pe,f(l.type),1),e("span",fe,f(new Date(l.created_at).toLocaleDateString()),1)]),e("div",_e,[e("span",null,[L("Qty Change: "),e("strong",null,f(l.quantity_change),1)]),e("span",ye,[L("New Qty: "),e("strong",null,f(l.new_quantity),1)])]),e("div",he,[e("span",null,[L("Warehouse: "),e("strong",null,f(((b=l.warehouse)==null?void 0:b.name)||l.warehouse_id),1)])]),e("div",xe,[e("span",null,[L("Note: "),e("em",null,f(l.note||"N/A"),1)])])])],2)}),128))]),e("div",be,[o.value>1?(m(),g("button",{key:0,onClick:u[0]||(u[0]=l=>j(o.value-1)),class:"px-3 py-1 bg-gray-300 rounded"}," Previous ")):P("",!0),e("div",null,"Page "+f(a.value.currentPage)+" of "+f(a.value.totalPages),1),o.value<a.value.totalPages?(m(),g("button",{key:1,onClick:u[1]||(u[1]=l=>j(o.value+1)),class:"px-3 py-1 bg-gray-300 rounded"}," Next ")):P("",!0)]),e("div",we,[!x.value&&y.value.length<D.value?(m(),g("button",{key:0,onClick:E,class:"px-4 py-1 bg-blue-600 text-white rounded text-xs"}," Load More ")):x.value?(m(),g("div",ke,"Loading...")):P("",!0)]),e("div",Ie,[e("button",{class:"px-4 py-2 bg-gray-200 rounded text-xs",onClick:u[2]||(u[2]=l=>p.value=!1)}," Close ")])])])):P("",!0)],64))}};export{We as default};
