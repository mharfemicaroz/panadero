import{a as d,d as ee,w as U,o as te,s as _,b as l,l as o,i as n,f as y,m as i,F as P,x as B,t as b,c as D,h as k,e as E,B as ae,C as le,W as se,y as oe,D as ne,E as re}from"./index.81ed66ed.js";import{_ as L}from"./TableCheckboxCell.5bd18b8c.js";import{_ as C}from"./BaseButton.4cf3599a.js";import{_ as ue}from"./BaseButtons.e89c9a47.js";import{V as ie,W as j,Z as ce,y as de,_ as ve,$ as he}from"./mdi.aa269c9f.js";import{_ as me}from"./_plugin-vue_export-helper.c27b6911.js";const M=r=>(ne("data-v-209436d9"),r=r(),re(),r),pe={class:"w-full border-collapse bg-white min-w-max"},ge={class:"bg-white text-gray-700 text-sm border-b"},fe={key:0,class:"p-2 w-10 text-center"},_e={class:"flex items-center justify-between"},ye={class:"font-medium"},be={class:"flex items-center gap-2"},ke={key:0,class:"mt-1 p-2 border rounded bg-white shadow-md"},we=["onUpdate:modelValue","onInput"],xe={key:1,class:"px-4 py-2 whitespace-nowrap"},Ce={key:0,class:"p-2 w-10 text-center","data-label":"Select"},Se=["data-label"],Pe={key:0},Be={key:1},Ve={key:1,class:"px-4 py-2 whitespace-nowrap","data-label":"Action"},$e={key:0,class:"border-t text-sm font-semibold bg-gray-50"},Ae={key:0,class:"p-2 w-10"},Fe=["data-label"],Ie={key:0},ze={key:1,class:"px-4 py-2"},Ue={class:"p-3 border-t bg-white text-sm flex flex-col sm:flex-row sm:justify-between sm:items-center"},De={class:"mb-2 sm:mb-0"},Me={class:"flex flex-wrap items-center gap-2"},Ne=["value"],Te=M(()=>n("option",{value:"5"},"5 / page",-1)),Ee=M(()=>n("option",{value:"10"},"10 / page",-1)),Le=M(()=>n("option",{value:"20"},"20 / page",-1)),je=[Te,Ee,Le],Re={__name:"BaseTable",props:{columns:Array,data:{type:Object,default:()=>({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]})},checkable:Boolean,loading:{type:Boolean,default:!1},showAction:{type:Boolean,default:!0}},emits:["query-change","selected","sort","filter","edit"],setup(r,{emit:w}){const v=r,N=d(null),R=ee.useLoading(),h=d(null);U(()=>v.loading,t=>{t?h.value||(h.value=R.show({container:N.value,canCancel:!1,isFullPage:!1,color:"#3b82f6",opacity:.8})):h.value&&(h.value.hide(),h.value=null)},{immediate:!0}),te(()=>{h.value&&(h.value.hide(),h.value=null)});const u=d(v.data.currentPage||1),g=d(v.data.pageSize||10),S=d(null),x=d("desc"),m=d({}),$=d({}),p=d(new Set);U(()=>v.data.currentPage,t=>{u.value=t||1}),U(()=>v.data.pageSize,t=>{g.value=t||10});const f=_(()=>v.data||{total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),A=_(()=>f.value.data.filter(t=>Object.keys(m.value).every(s=>{var e;return m.value[s]?(e=t[s])==null?void 0:e.toString().toLowerCase().includes(m.value[s].toLowerCase()):!0}))),O=_(()=>p.value.size===A.value.length&&A.value.length>0),F=_(()=>f.value.totalPages||Math.ceil(f.value.total/g.value)||1),q=_(()=>{const t=F.value,s=u.value,e=2,a=[];if(t<=7)for(let c=1;c<=t;c++)a.push(c);else{a.push(1);let c=Math.max(2,s-e),T=Math.min(t-1,s+e);c>2&&a.push("...");for(let z=c;z<=T;z++)a.push(z);T<t-1&&a.push("..."),a.push(t)}return a}),V=()=>{w("query-change",{page:u.value,limit:g.value,sort:S.value,order:x.value,filters:m.value})},I=t=>{t>=1&&t<=F.value&&(u.value=t,V())},W=t=>{g.value=Number(t.target.value),u.value=1,V()},K=t=>{S.value===t?x.value=x.value==="asc"?"desc":"asc":(S.value=t,x.value="desc"),w("sort",{key:S.value,order:x.value}),V()},Q=t=>{$.value[t]=!$.value[t]},Z=(t,s)=>{m.value[t]=s,w("filter",m.value),V()},G=t=>{t?p.value=new Set(A.value.map(s=>s.id)):p.value.clear(),w("selected",Array.from(p.value))},H=(t,s)=>{t?p.value.add(s.id):p.value.delete(s.id),w("selected",Array.from(p.value))},J=t=>{w("edit",t)},X=_(()=>{const t={};return v.columns.forEach(s=>{if(s.aggregate){let e=0;f.value.data.forEach(a=>{const c=parseFloat(a[s.key]);isNaN(c)||(e+=c)}),t[s.key]=e}}),t}),Y=_(()=>v.columns.some(t=>t.aggregate));return(t,s)=>(l(),o("div",{ref_key:"tableContainer",ref:N,class:"table-container relative rounded-lg border border-gray-200 shadow-sm bg-white"},[n("table",pe,[n("thead",ge,[n("tr",null,[r.checkable?(l(),o("th",fe,[y(L,{modelValue:O.value,"onUpdate:modelValue":G},null,8,["modelValue"])])):i("",!0),(l(!0),o(P,null,B(r.columns,e=>(l(),o("th",{key:e.key,class:"px-4 py-2 text-left whitespace-nowrap"},[n("div",_e,[n("span",ye,b(e.label),1),n("div",be,[e.sortable?(l(),D(C,{key:0,icon:S.value===e.key?x.value==="asc"?k(ie):k(j):k(j),small:"",onClick:a=>K(e.key)},null,8,["icon","onClick"])):i("",!0),e.filterable?(l(),D(C,{key:1,icon:k(ce),small:"",onClick:a=>Q(e.key)},null,8,["icon","onClick"])):i("",!0)])]),y(se,{name:"fade"},{default:E(()=>[$.value[e.key]?(l(),o("div",ke,[ae(n("input",{"onUpdate:modelValue":a=>m.value[e.key]=a,class:"w-full px-2 py-1 text-xs border rounded",placeholder:"Filter...",onInput:a=>Z(e.key,a.target.value)},null,40,we),[[le,m.value[e.key]]])])):i("",!0)]),_:2},1024)]))),128)),r.showAction?(l(),o("th",xe,"Action")):i("",!0)])]),n("tbody",null,[(l(!0),o(P,null,B(f.value.data,e=>(l(),o("tr",{key:e.id,class:"border-t text-sm hover:bg-gray-50"},[r.checkable?(l(),o("td",Ce,[y(L,{modelValue:p.value.has(e.id),"onUpdate:modelValue":a=>H(a,e)},null,8,["modelValue","onUpdate:modelValue"])])):i("",!0),(l(!0),o(P,null,B(r.columns,a=>(l(),o("td",{key:a.key,class:"px-4 py-2 whitespace-nowrap","data-label":a.label},[a.formatter?(l(),o("span",Pe,b(a.formatter(e[a.key],e)),1)):(l(),o("span",Be,b(e[a.key]||"-"),1))],8,Se))),128)),r.showAction?(l(),o("td",Ve,[oe(t.$slots,"cell-actions",{row:e},()=>[y(ue,null,{default:E(()=>[y(C,{icon:k(de),small:"",onClick:a=>J(e)},null,8,["icon","onClick"])]),_:2},1024)],!0)])):i("",!0)]))),128)),Y.value?(l(),o("tr",$e,[r.checkable?(l(),o("td",Ae)):i("",!0),(l(!0),o(P,null,B(r.columns,e=>(l(),o("td",{key:e.key,class:"px-4 py-2 whitespace-nowrap","data-label":e.label},[e.aggregate?(l(),o("span",Ie,b(X.value[e.key]),1)):i("",!0)],8,Fe))),128)),r.showAction?(l(),o("td",ze)):i("",!0)])):i("",!0)])]),n("div",Ue,[n("span",De,b((u.value-1)*g.value+1)+" - "+b(Math.min(u.value*g.value,f.value.total))+" of "+b(f.value.total)+" items ",1),n("div",Me,[y(C,{icon:k(ve),small:"",disabled:u.value===1,onClick:s[0]||(s[0]=e=>I(u.value-1))},null,8,["icon","disabled"]),(l(!0),o(P,null,B(q.value,(e,a)=>(l(),D(C,{key:a,active:e!=="..."&&e===u.value,label:e,small:"",disabled:e==="...",onClick:c=>e!=="..."&&I(e)},null,8,["active","label","disabled","onClick"]))),128)),y(C,{icon:k(he),small:"",disabled:u.value===F.value,onClick:s[1]||(s[1]=e=>I(u.value+1))},null,8,["icon","disabled"]),n("select",{class:"border p-1 text-sm rounded",onChange:W,value:g.value},je,40,Ne)])])],512))}},Ge=me(Re,[["__scopeId","data-v-209436d9"]]);export{Ge as B};
