import{J as x,K as j,a as v,s as z,b as w,c as U,e as k,f as D,h as f,v as E,t as O,m as I,i as e,l as A,B as c,C as h,L as g,M as C,S as F}from"./index.fa4aaca0.js";import{_ as R}from"./LayoutAuthenticatedX.903f0881.js";import{_ as Q}from"./SectionMain.65752272.js";import{_ as G}from"./NotificationBar.2dd16147.js";import{B as H}from"./BaseTable.3881ec66.js";import{_ as J}from"./CardBox.a1184ae0.js";import{_ as K}from"./SectionTitleLineWithButton.8dc98713.js";import{_ as N}from"./BaseButton.7542bf1a.js";import{p as Y,c as W,u as X,v as Z}from"./mdi.50c7bbe5.js";import{A as S}from"./index.73340c3e.js";import"./darkMode.dc7262dc.js";import"./BaseIcon.4caf67cb.js";import"./FormControl.1d43ffa3.js";import"./FooterBar.843fa662.js";import"./logo.c6f18b48.js";import"./BaseLevel.511e0059.js";import"./TableCheckboxCell.5507bf42.js";import"./BaseButtons.446b06e3.js";import"./_plugin-vue_export-helper.c27b6911.js";const P={async create(s){return(await x.post(`${S}/deductions`,s)).data},async getById(s){return(await x.get(`${S}/deductions/${s}`)).data},async updateById(s,l){return(await x.put(`${S}/deductions/${s}`,l)).data},async delete(s){return(await x.delete(`${S}/deductions/${s}`)).data},async list(s){return(await x.get(`${S}/deductions`,{params:s})).data}},ee=j("deduction",()=>{const s=v({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),l=v(!1),r=v(null),a=v(!1);return{items:s,isLoading:l,error:r,isLoaded:a,fetchItems:async(m={},_=!1)=>{var d;if(r.value=null,!(!_&&a.value))try{l.value=!0;const p=await P.list(m);Object.assign(s.value,{total:p.total||0,totalPages:p.totalPages||1,currentPage:m.page||1,pageSize:m.limit||10,data:p.data||[]}),a.value=!0}catch(p){r.value=((d=p==null?void 0:p.response)==null?void 0:d.message)||"Failed to fetch deductions"}finally{l.value=!1}},createItem:async m=>{var _;r.value=null;try{l.value=!0;const d=await P.create(m);s.value.data.push(d),s.value.total+=1}catch(d){r.value=((_=d==null?void 0:d.response)==null?void 0:_.message)||"Failed to create deduction"}finally{l.value=!1}},updateItem:async(m,_)=>{var d;r.value=null;try{l.value=!0;const p=await P.updateById(m,_),q=s.value.data.findIndex(V=>V.id===m);q!==-1&&(s.value.data[q]=p)}catch(p){r.value=((d=p==null?void 0:p.response)==null?void 0:d.message)||"Failed to update deduction"}finally{l.value=!1}},deleteItem:async m=>{var _;r.value=null;try{l.value=!0,await P.delete(m),s.value.data=s.value.data.filter(d=>d.id!==m),s.value.total-=1}catch(d){r.value=((_=d==null?void 0:d.response)==null?void 0:_.message)||"Failed to delete deduction"}finally{l.value=!1}},resetStore:()=>{s.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},a.value=!1,l.value=!1,r.value=null}}}),te={class:"flex items-center gap-2"},oe={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},ae={class:"bg-white p-6 rounded shadow-lg w-[600px]"},se=e("h2",{class:"text-xl mb-4"},"Add Deduction",-1),le={class:"grid grid-cols-2 gap-4"},ne={class:"col-span-2"},ie=e("label",{class:"block mb-1"},"Name",-1),ue={class:"col-span-2"},de=e("label",{class:"block mb-1"},"Description",-1),re=e("label",{class:"block mb-1"},"Type",-1),ce=e("option",{value:"tax"},"Tax",-1),pe=e("option",{value:"sss"},"SSS",-1),me=e("option",{value:"philhealth"},"PhilHealth",-1),_e=e("option",{value:"pagibig"},"Pag-IBIG",-1),ve=e("option",{value:"loan"},"Loan",-1),fe=e("option",{value:"cash_advance"},"Cash Advance",-1),ye=e("option",{value:"other"},"Other",-1),be=[ce,pe,me,_e,ve,fe,ye],he=e("label",{class:"block mb-1"},"Amount Type",-1),ge=e("option",{value:"fixed"},"Fixed",-1),xe=e("option",{value:"percentage"},"Percentage",-1),we=[ge,xe],ke=e("label",{class:"block mb-1"},"Amount",-1),De=e("label",{class:"block mb-1"},"Frequency",-1),Se=e("option",{value:"per_payroll"},"Per Payroll",-1),qe=e("option",{value:"monthly"},"Monthly",-1),Ie=e("option",{value:"quarterly"},"Quarterly",-1),Ce=e("option",{value:"annual"},"Annual",-1),Pe=e("option",{value:"one_time"},"One Time",-1),Ve=[Se,qe,Ie,Ce,Pe],Ue={class:"flex items-center gap-4"},Be={class:"flex items-center"},Te=e("span",{class:"mr-1"},"Recurring",-1),$e={class:"flex items-center"},Ae=e("span",{class:"mr-1"},"Required",-1),Fe={class:"flex justify-end space-x-2 mt-4"},Ne={key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},Le={class:"bg-white p-6 rounded shadow-lg w-[600px]"},Me=e("h2",{class:"text-xl mb-4"},"Edit Deduction",-1),je={class:"grid grid-cols-2 gap-4"},ze={class:"col-span-2"},Ee=e("label",{class:"block mb-1"},"Name",-1),Oe={class:"col-span-2"},Re=e("label",{class:"block mb-1"},"Description",-1),Qe=e("label",{class:"block mb-1"},"Type",-1),Ge=e("option",{value:"tax"},"Tax",-1),He=e("option",{value:"sss"},"SSS",-1),Je=e("option",{value:"philhealth"},"PhilHealth",-1),Ke=e("option",{value:"pagibig"},"Pag-IBIG",-1),Ye=e("option",{value:"loan"},"Loan",-1),We=e("option",{value:"cash_advance"},"Cash Advance",-1),Xe=e("option",{value:"other"},"Other",-1),Ze=[Ge,He,Je,Ke,Ye,We,Xe],et=e("label",{class:"block mb-1"},"Amount Type",-1),tt=e("option",{value:"fixed"},"Fixed",-1),ot=e("option",{value:"percentage"},"Percentage",-1),at=[tt,ot],st=e("label",{class:"block mb-1"},"Amount",-1),lt=e("label",{class:"block mb-1"},"Frequency",-1),nt=e("option",{value:"per_payroll"},"Per Payroll",-1),it=e("option",{value:"monthly"},"Monthly",-1),ut=e("option",{value:"quarterly"},"Quarterly",-1),dt=e("option",{value:"annual"},"Annual",-1),rt=e("option",{value:"one_time"},"One Time",-1),ct=[nt,it,ut,dt,rt],pt={class:"flex items-center gap-4"},mt={class:"flex items-center"},_t=e("span",{class:"mr-1"},"Recurring",-1),vt={class:"flex items-center"},ft=e("span",{class:"mr-1"},"Required",-1),yt={class:"flex justify-end space-x-2 mt-4"},Nt={__name:"DeductionsView",setup(s){const l=v(!1),r=v(!1),a=v({name:"",description:"",type:"tax",amount_type:"fixed",amount:0,is_recurring:!0,is_required:!0,frequency:"per_payroll"}),n=v({id:null,name:"",description:"",type:"tax",amount_type:"fixed",amount:0,is_recurring:!0,is_required:!0,frequency:"per_payroll"}),u=ee(),y=v([]);async function b(i={},t=!1){await u.fetchItems(i,t)}b({page:1,limit:10});const B=z(()=>{var i,t,o,T,$;return{total:((i=u.items)==null?void 0:i.total)||0,totalPages:((t=u.items)==null?void 0:t.totalPages)||1,currentPage:((o=u.items)==null?void 0:o.currentPage)||1,pageSize:((T=u.items)==null?void 0:T.pageSize)||10,data:(($=u.items)==null?void 0:$.data)||[]}}),m=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"type",label:"Type",sortable:!0,filterable:!0},{key:"amount_type",label:"Amount Type",sortable:!0,filterable:!0},{key:"amount",label:"Amount",sortable:!0,filterable:!0},{key:"frequency",label:"Frequency",sortable:!0,filterable:!0}],_=async i=>{await b(i,!0)},d=i=>{y.value=i},p=async i=>{u.isLoading=!0,n.value={id:i.id,name:i.name,description:i.description,type:i.type,amount_type:i.amount_type,amount:i.amount,is_recurring:i.is_recurring,is_required:i.is_required,frequency:i.frequency},r.value=!0,u.isLoading=!1},q=()=>{a.value={name:"",description:"",type:"tax",amount_type:"fixed",amount:0,is_recurring:!0,is_required:!0,frequency:"per_payroll"},l.value=!0};async function V(){await u.createItem(a.value),u.error||(l.value=!1,await b({page:1,limit:10},!0))}async function L(){await u.updateItem(n.value.id,n.value),u.error||(r.value=!1,await b({page:1,limit:10},!0))}async function M(){if(y.value.length===0)return;if((await F.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete them!"})).isConfirmed){for(const t of y.value)if(await u.deleteItem(t),u.error)break;u.error||(y.value=[],await b({page:1,limit:10},!0),F.fire("Deleted!","The deductions have been deleted.","success"))}}return(i,t)=>(w(),U(R,null,{default:k(()=>[D(Q,null,{default:k(()=>[f(u).error?(w(),U(G,{key:0,icon:f(Y),color:"danger"},{default:k(()=>[E(O(f(u).error),1)]),_:1},8,["icon"])):I("",!0),D(K,{icon:f(W),title:"Deductions",main:""},{default:k(()=>[e("div",te,[D(N,{icon:f(X),color:"primary",label:"New Deduction",onClick:q},null,8,["icon"]),y.value.length?(w(),U(N,{key:0,icon:f(Z),color:"danger",label:"Delete",onClick:M},null,8,["icon"])):I("",!0)])]),_:1},8,["icon"]),D(J,{class:"mb-6"},{default:k(()=>[D(H,{columns:m,data:B.value,loading:f(u).isLoading,checkable:"",onQueryChange:_,onSelected:d,onEdit:p},null,8,["data","loading"])]),_:1})]),_:1}),l.value?(w(),A("div",oe,[e("div",ae,[se,e("div",le,[e("div",ne,[ie,c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.name=o),type:"text",class:"w-full border p-2 rounded"},null,512),[[h,a.value.name]])]),e("div",ue,[de,c(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.description=o),class:"w-full border p-2 rounded"},null,512),[[h,a.value.description]])]),e("div",null,[re,c(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.type=o),class:"w-full border p-2 rounded"},be,512),[[g,a.value.type]])]),e("div",null,[he,c(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.amount_type=o),class:"w-full border p-2 rounded"},we,512),[[g,a.value.amount_type]])]),e("div",null,[ke,c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.amount=o),type:"number",step:"0.01",class:"w-full border p-2 rounded"},null,512),[[h,a.value.amount,void 0,{number:!0}]])]),e("div",null,[De,c(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.frequency=o),class:"w-full border p-2 rounded"},Ve,512),[[g,a.value.frequency]])]),e("div",Ue,[e("label",Be,[Te,c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.is_recurring=o),type:"checkbox",class:"mt-0"},null,512),[[C,a.value.is_recurring]])]),e("label",$e,[Ae,c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>a.value.is_required=o),type:"checkbox",class:"mt-0"},null,512),[[C,a.value.is_required]])])])]),e("div",Fe,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[8]||(t[8]=o=>l.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:V}," Save ")])])])):I("",!0),r.value?(w(),A("div",Ne,[e("div",Le,[Me,e("div",je,[e("div",ze,[Ee,c(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>n.value.name=o),type:"text",class:"w-full border p-2 rounded"},null,512),[[h,n.value.name]])]),e("div",Oe,[Re,c(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=o=>n.value.description=o),class:"w-full border p-2 rounded"},null,512),[[h,n.value.description]])]),e("div",null,[Qe,c(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>n.value.type=o),class:"w-full border p-2 rounded"},Ze,512),[[g,n.value.type]])]),e("div",null,[et,c(e("select",{"onUpdate:modelValue":t[12]||(t[12]=o=>n.value.amount_type=o),class:"w-full border p-2 rounded"},at,512),[[g,n.value.amount_type]])]),e("div",null,[st,c(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>n.value.amount=o),type:"number",step:"0.01",class:"w-full border p-2 rounded"},null,512),[[h,n.value.amount,void 0,{number:!0}]])]),e("div",null,[lt,c(e("select",{"onUpdate:modelValue":t[14]||(t[14]=o=>n.value.frequency=o),class:"w-full border p-2 rounded"},ct,512),[[g,n.value.frequency]])]),e("div",pt,[e("label",mt,[_t,c(e("input",{"onUpdate:modelValue":t[15]||(t[15]=o=>n.value.is_recurring=o),type:"checkbox",class:"mt-0"},null,512),[[C,n.value.is_recurring]])]),e("label",vt,[ft,c(e("input",{"onUpdate:modelValue":t[16]||(t[16]=o=>n.value.is_required=o),type:"checkbox",class:"mt-0"},null,512),[[C,n.value.is_required]])])])]),e("div",yt,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[17]||(t[17]=o=>r.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:L}," Update ")])])])):I("",!0)]),_:1}))}};export{Nt as default};
