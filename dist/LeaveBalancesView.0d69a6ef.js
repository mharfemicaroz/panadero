import{J as g,K as H,a as f,s as N,q as W,b as p,c as M,e as x,f as S,h as y,v as X,t as I,m as C,i as e,l as _,B as b,L as F,F as D,x as E,C as T,S as z}from"./index.a2c9f28c.js";import{_ as Z}from"./LayoutAuthenticatedX.d58fd7d8.js";import{_ as q}from"./SectionMain.8435c1f0.js";import{A as h}from"./index.0363223d.js";import{u as ee}from"./employeeStore.497070e0.js";import{u as ae}from"./leaveTypeStore.172cb786.js";import{_ as le}from"./NotificationBar.caa84e93.js";import{B as te}from"./BaseTable.a063d648.js";import{_ as se}from"./CardBox.25a3dc7a.js";import{_ as oe}from"./SectionTitleLineWithButton.39476921.js";import{_ as A}from"./BaseButton.b8e12a74.js";import{p as ne,c as re,u as ie,v as de}from"./mdi.aa269c9f.js";import"./darkMode.b88882a1.js";import"./BaseIcon.ad3a4017.js";import"./FormControl.2759acc3.js";import"./FooterBar.948c11c8.js";import"./logo.c6f18b48.js";import"./BaseLevel.e0eed931.js";import"./TableCheckboxCell.8ab5003b.js";import"./BaseButtons.e7208c74.js";import"./_plugin-vue_export-helper.c27b6911.js";const B={async create(o){return(await g.post(`${h}/leaves/balances`,o)).data},async getById(o){return(await g.get(`${h}/leaves/balances/${o}`)).data},async updateById(o,t){return(await g.put(`${h}/leaves/balances/${o}`,t)).data},async delete(o){return(await g.delete(`${h}/leaves/balances/${o}`)).data},async list(o){return(await g.get(`${h}/leaves/balances`,{params:o})).data},async getEmployeeLeaveBalance(o){return(await g.get(`${h}/leaves/employee/${o}/balance`)).data},async carryForward(o,t){return(await g.post(`${h}/leaves/employee/${o}/leave-type/${t}/carry-forward`)).data}},ue=H("leaveBalance",()=>{const o=f({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),t=f(!1),r=f(null),c=f(!1);return{items:o,isLoading:t,error:r,isLoaded:c,fetchItems:async(i={},v=!1)=>{var s;if(r.value=null,!(!v&&c.value))try{t.value=!0;const d=await B.list(i);Object.assign(o.value,{total:d.total||0,totalPages:d.totalPages||1,currentPage:i.page||1,pageSize:i.limit||10,data:d.data||[]}),c.value=!0}catch(d){r.value=((s=d==null?void 0:d.response)==null?void 0:s.message)||"Failed to fetch leave balances"}finally{t.value=!1}},createItem:async i=>{var v;r.value=null;try{t.value=!0;const s=await B.create(i);o.value.data.push(s),o.value.total+=1}catch(s){r.value=((v=s==null?void 0:s.response)==null?void 0:v.message)||"Failed to create leave balance"}finally{t.value=!1}},updateItem:async(i,v)=>{var s;r.value=null;try{t.value=!0;const d=await B.updateById(i,v),$=o.value.data.findIndex(U=>U.id===i);$!==-1&&(o.value.data[$]=d)}catch(d){r.value=((s=d==null?void 0:d.response)==null?void 0:s.message)||"Failed to update leave balance"}finally{t.value=!1}},deleteItem:async i=>{var v;r.value=null;try{t.value=!0,await B.delete(i),o.value.data=o.value.data.filter(s=>s.id!==i),o.value.total-=1}catch(s){r.value=((v=s==null?void 0:s.response)==null?void 0:v.message)||"Failed to delete leave balance"}finally{t.value=!1}},getEmployeeLeaveBalance:async i=>{var v;r.value=null;try{return t.value=!0,await B.getEmployeeLeaveBalance(i)}catch(s){r.value=((v=s==null?void 0:s.response)==null?void 0:v.message)||"Failed to fetch employee leave balance"}finally{t.value=!1}},carryForward:async(i,v)=>{var s;r.value=null;try{return t.value=!0,await B.carryForward(i,v)}catch(d){r.value=((s=d==null?void 0:d.response)==null?void 0:s.message)||"Failed to carry forward leave balance"}finally{t.value=!1}},resetStore:()=>{o.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},c.value=!1,t.value=!1,r.value=null}}}),ce={class:"flex items-center gap-2"},ve={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},pe={class:"bg-white p-6 rounded shadow-lg w-[600px]"},me=e("h2",{class:"text-xl mb-4"},"Add Leave Balance",-1),ye={class:"grid grid-cols-1 gap-4"},_e=e("label",{class:"block mb-1"},"Employee",-1),fe=["disabled"],be=e("option",{value:""},"Select Employee",-1),ge=["value"],he=e("label",{class:"block mb-1"},"Leave Type",-1),we=["disabled"],Be=e("option",{value:""},"Select Leave Type",-1),Le=["value"],ke=e("label",{class:"block mb-1"},"Total Days",-1),xe=e("label",{class:"block mb-1"},"Year",-1),Se={key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},Ie={class:"bg-white p-6 rounded shadow-lg w-[600px]"},$e=e("h2",{class:"text-xl mb-4"},"Edit Leave Balance",-1),Ce={class:"grid grid-cols-1 gap-4"},Fe=e("label",{class:"block mb-1"},"Employee",-1),De=["disabled"],Ee=e("option",{value:""},"Select Employee",-1),Te=["value"],Ve=e("label",{class:"block mb-1"},"Leave Type",-1),Pe=["disabled"],Ue=e("option",{value:""},"Select Leave Type",-1),Ne=["value"],Me=e("label",{class:"block mb-1"},"Total Days",-1),Ye=e("label",{class:"block mb-1"},"Year",-1),ra={__name:"LeaveBalancesView",setup(o){const t=f(!1),r=f(!1),c=f({employee_id:"",leave_type_id:"",total_days:0,year:new Date().getFullYear()}),m=f({id:null,employee_id:"",leave_type_id:"",total_days:0,year:new Date().getFullYear()}),u=ue(),L=ee(),k=ae(),w=f([]),V=N(()=>L.items.data.map(n=>({value:n.id,label:`${n.first_name} ${n.last_name}`}))),P=N(()=>k.items.data.map(n=>({value:n.id,label:n.name})));W(async()=>{await L.fetchItems({page:1,limit:1e3}),await k.fetchItems({page:1,limit:1e3})});async function i(n={},l=!1){await u.fetchItems(n,l)}i({page:1,limit:5});const v=N(()=>{var n,l,a,Y,j;return{total:((n=u.items)==null?void 0:n.total)||0,totalPages:((l=u.items)==null?void 0:l.totalPages)||1,currentPage:((a=u.items)==null?void 0:a.currentPage)||1,pageSize:((Y=u.items)==null?void 0:Y.pageSize)||5,data:((j=u.items)==null?void 0:j.data)||[]}}),s=[{key:"employee_id",label:"Employees Full Name",sortable:!0,formatter:(n,l)=>l.employee?l.employee.first_name+" "+l.employee.last_name:""},{key:"leave_type_id",label:"Leave Type",sortable:!0,formatter:(n,l)=>l.leaveType?l.leaveType.name:""},{key:"total_days",label:"Total Days",sortable:!0},{key:"used_days",label:"Used Days",sortable:!0},{key:"remaining_days",label:"Remaining Days",sortable:!0},{key:"year",label:"Year",sortable:!0}],d=async n=>{await i(n,!0)},$=n=>{w.value=n},U=n=>{m.value={id:n.id,employee_id:n.employee_id,leave_type_id:n.leave_type_id,total_days:n.total_days,year:n.year},r.value=!0},O=()=>{c.value={employee_id:"",leave_type_id:"",total_days:0,year:new Date().getFullYear()},t.value=!0};async function Q(){await u.createItem({...c.value,used_days:0,remaining_days:c.value.total_days}),u.error||(t.value=!1,await i({page:1,limit:5},!0))}async function R(){await u.updateItem(m.value.id,m.value),u.error||(r.value=!1,await i({page:1,limit:5},!0))}async function J(){if(w.value.length===0)return;if((await z.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete them!"})).isConfirmed){for(const l of w.value)if(await u.deleteItem(l),u.error)break;u.error||(w.value=[],await i({page:1,limit:5},!0),z.fire("Deleted!","The leave balances have been deleted.","success"))}}const K=()=>{t.value=!1},G=()=>{r.value=!1};return(n,l)=>(p(),M(Z,null,{default:x(()=>[S(q,null,{default:x(()=>[y(u).error?(p(),M(le,{key:0,icon:y(ne),color:"danger"},{default:x(()=>[X(I(y(u).error),1)]),_:1},8,["icon"])):C("",!0),S(oe,{icon:y(re),title:"Leave Balances",main:""},{default:x(()=>[e("div",ce,[S(A,{icon:y(ie),color:"primary",label:"New Leave Balance",onClick:O},null,8,["icon"]),w.value.length?(p(),M(A,{key:0,icon:y(de),color:"danger",label:"Delete",onClick:J},null,8,["icon"])):C("",!0)])]),_:1},8,["icon"]),S(se,{class:"mb-6"},{default:x(()=>[S(te,{columns:s,data:v.value,loading:y(u).isLoading,checkable:"",onQueryChange:d,onSelected:$,onEdit:U},null,8,["data","loading"])]),_:1})]),_:1}),t.value?(p(),_("div",ve,[e("div",pe,[me,e("div",ye,[e("div",null,[_e,b(e("select",{"onUpdate:modelValue":l[0]||(l[0]=a=>c.value.employee_id=a),class:"w-full border p-2 rounded",disabled:y(L).isLoading},[be,(p(!0),_(D,null,E(V.value,a=>(p(),_("option",{key:a.value,value:a.value},I(a.label),9,ge))),128))],8,fe),[[F,c.value.employee_id]])]),e("div",null,[he,b(e("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>c.value.leave_type_id=a),class:"w-full border p-2 rounded",disabled:y(k).isLoading},[Be,(p(!0),_(D,null,E(P.value,a=>(p(),_("option",{key:a.value,value:a.value},I(a.label),9,Le))),128))],8,we),[[F,c.value.leave_type_id]])]),e("div",null,[ke,b(e("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>c.value.total_days=a),type:"number",class:"w-full border p-2 rounded"},null,512),[[T,c.value.total_days]])]),e("div",null,[xe,b(e("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>c.value.year=a),type:"number",class:"w-full border p-2 rounded"},null,512),[[T,c.value.year]])])]),e("div",{class:"flex justify-end space-x-2 mt-4"},[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:K}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:Q}," Save ")])])])):C("",!0),r.value?(p(),_("div",Se,[e("div",Ie,[$e,e("div",Ce,[e("div",null,[Fe,b(e("select",{"onUpdate:modelValue":l[4]||(l[4]=a=>m.value.employee_id=a),class:"w-full border p-2 rounded",disabled:y(L).isLoading},[Ee,(p(!0),_(D,null,E(V.value,a=>(p(),_("option",{key:a.value,value:a.value},I(a.label),9,Te))),128))],8,De),[[F,m.value.employee_id]])]),e("div",null,[Ve,b(e("select",{"onUpdate:modelValue":l[5]||(l[5]=a=>m.value.leave_type_id=a),class:"w-full border p-2 rounded",disabled:y(k).isLoading},[Ue,(p(!0),_(D,null,E(P.value,a=>(p(),_("option",{key:a.value,value:a.value},I(a.label),9,Ne))),128))],8,Pe),[[F,m.value.leave_type_id]])]),e("div",null,[Me,b(e("input",{"onUpdate:modelValue":l[6]||(l[6]=a=>m.value.total_days=a),type:"number",class:"w-full border p-2 rounded"},null,512),[[T,m.value.total_days]])]),e("div",null,[Ye,b(e("input",{"onUpdate:modelValue":l[7]||(l[7]=a=>m.value.year=a),type:"number",class:"w-full border p-2 rounded"},null,512),[[T,m.value.year]])])]),e("div",{class:"flex justify-end space-x-2 mt-4"},[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:G}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:R}," Update ")])])])):C("",!0)]),_:1}))}};export{ra as default};
