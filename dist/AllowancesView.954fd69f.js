import{J as w,K as L,a as v,s as j,b as x,c as P,e as k,f as A,h as f,v as z,t as O,m as S,i as e,l as M,B as c,C as b,L as h,M as U,S as F}from"./index.fa4aaca0.js";import{_ as R}from"./LayoutAuthenticatedX.903f0881.js";import{_ as Q}from"./SectionMain.65752272.js";import{_ as H}from"./NotificationBar.2dd16147.js";import{B as J}from"./BaseTable.3881ec66.js";import{_ as K}from"./CardBox.a1184ae0.js";import{_ as Y}from"./SectionTitleLineWithButton.8dc98713.js";import{_ as N}from"./BaseButton.7542bf1a.js";import{p as G,c as W,u as X,v as Z}from"./mdi.50c7bbe5.js";import{A as C}from"./index.73340c3e.js";import"./darkMode.dc7262dc.js";import"./BaseIcon.4caf67cb.js";import"./FormControl.1d43ffa3.js";import"./FooterBar.843fa662.js";import"./logo.c6f18b48.js";import"./BaseLevel.511e0059.js";import"./TableCheckboxCell.5507bf42.js";import"./BaseButtons.446b06e3.js";import"./_plugin-vue_export-helper.c27b6911.js";const I={async create(s){return(await w.post(`${C}/allowances`,s)).data},async getById(s){return(await w.get(`${C}/allowances/${s}`)).data},async updateById(s,n){return(await w.put(`${C}/allowances/${s}`,n)).data},async delete(s){return(await w.delete(`${C}/allowances/${s}`)).data},async list(s){return(await w.get(`${C}/allowances`,{params:s})).data}},ee=L("allowance",()=>{const s=v({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),n=v(!1),d=v(null),a=v(!1);return{items:s,isLoading:n,error:d,isLoaded:a,fetchItems:async(m={},_=!1)=>{var u;if(d.value=null,!(!_&&a.value))try{n.value=!0;const p=await I.list(m);Object.assign(s.value,{total:p.total||0,totalPages:p.totalPages||1,currentPage:m.page||1,pageSize:m.limit||10,data:p.data||[]}),a.value=!0}catch(p){d.value=((u=p==null?void 0:p.response)==null?void 0:u.message)||"Failed to fetch allowances"}finally{n.value=!1}},createItem:async m=>{var _;d.value=null;try{n.value=!0;const u=await I.create(m);s.value.data.push(u),s.value.total+=1}catch(u){d.value=((_=u==null?void 0:u.response)==null?void 0:_.message)||"Failed to create allowance"}finally{n.value=!1}},updateItem:async(m,_)=>{var u;d.value=null;try{n.value=!0;const p=await I.updateById(m,_),V=s.value.data.findIndex(T=>T.id===m);V!==-1&&(s.value.data[V]=p)}catch(p){d.value=((u=p==null?void 0:p.response)==null?void 0:u.message)||"Failed to update allowance"}finally{n.value=!1}},deleteItem:async m=>{var _;d.value=null;try{n.value=!0,await I.delete(m),s.value.data=s.value.data.filter(u=>u.id!==m),s.value.total-=1}catch(u){d.value=((_=u==null?void 0:u.response)==null?void 0:_.message)||"Failed to delete allowance"}finally{n.value=!1}},resetStore:()=>{s.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},a.value=!1,n.value=!1,d.value=null}}}),te={class:"flex items-center gap-2"},le={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},ae={class:"bg-white p-6 rounded shadow-lg w-[600px]"},oe=e("h2",{class:"text-xl mb-4"},"Add Allowance",-1),se={class:"grid grid-cols-2 gap-4"},ne={class:"col-span-2"},ie=e("label",{class:"block mb-1"},"Name",-1),re={class:"col-span-2"},ue=e("label",{class:"block mb-1"},"Description",-1),ce=e("label",{class:"block mb-1"},"Type",-1),de=e("option",{value:"transportation"},"Transportation",-1),pe=e("option",{value:"meal"},"Meal",-1),me=e("option",{value:"housing"},"Housing",-1),_e=e("option",{value:"communication"},"Communication",-1),ve=e("option",{value:"medical"},"Medical",-1),be=e("option",{value:"representation"},"Representation",-1),fe=e("option",{value:"other"},"Other",-1),ye=[de,pe,me,_e,ve,be,fe],ge=e("label",{class:"block mb-1"},"Amount Type",-1),he=e("option",{value:"fixed"},"Fixed",-1),we=e("option",{value:"percentage"},"Percentage",-1),xe=[he,we],ke=e("label",{class:"block mb-1"},"Amount",-1),Ae=e("label",{class:"block mb-1"},"Frequency",-1),Ce=e("option",{value:"per_payroll"},"Per Payroll",-1),Ve=e("option",{value:"monthly"},"Monthly",-1),Se=e("option",{value:"quarterly"},"Quarterly",-1),Ue=e("option",{value:"annual"},"Annual",-1),Ie=e("option",{value:"one_time"},"One Time",-1),Te=[Ce,Ve,Se,Ue,Ie],Pe={class:"col-span-2"},$e=e("label",{class:"block mb-1"},"Eligibility Criteria",-1),Be={class:"flex items-center gap-4"},qe={class:"flex items-center"},Me=e("span",{class:"mr-1"},"Taxable",-1),Fe={class:"flex items-center"},Ne=e("span",{class:"mr-1"},"Recurring",-1),De={class:"flex justify-end space-x-2 mt-4"},Ee={key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},Le={class:"bg-white p-6 rounded shadow-lg w-[600px]"},je=e("h2",{class:"text-xl mb-4"},"Edit Allowance",-1),ze={class:"grid grid-cols-2 gap-4"},Oe={class:"col-span-2"},Re=e("label",{class:"block mb-1"},"Name",-1),Qe={class:"col-span-2"},He=e("label",{class:"block mb-1"},"Description",-1),Je=e("label",{class:"block mb-1"},"Type",-1),Ke=e("option",{value:"transportation"},"Transportation",-1),Ye=e("option",{value:"meal"},"Meal",-1),Ge=e("option",{value:"housing"},"Housing",-1),We=e("option",{value:"communication"},"Communication",-1),Xe=e("option",{value:"medical"},"Medical",-1),Ze=e("option",{value:"representation"},"Representation",-1),et=e("option",{value:"other"},"Other",-1),tt=[Ke,Ye,Ge,We,Xe,Ze,et],lt=e("label",{class:"block mb-1"},"Amount Type",-1),at=e("option",{value:"fixed"},"Fixed",-1),ot=e("option",{value:"percentage"},"Percentage",-1),st=[at,ot],nt=e("label",{class:"block mb-1"},"Amount",-1),it=e("label",{class:"block mb-1"},"Frequency",-1),rt=e("option",{value:"per_payroll"},"Per Payroll",-1),ut=e("option",{value:"monthly"},"Monthly",-1),ct=e("option",{value:"quarterly"},"Quarterly",-1),dt=e("option",{value:"annual"},"Annual",-1),pt=e("option",{value:"one_time"},"One Time",-1),mt=[rt,ut,ct,dt,pt],_t={class:"col-span-2"},vt=e("label",{class:"block mb-1"},"Eligibility Criteria",-1),bt={class:"flex items-center gap-4"},ft={class:"flex items-center"},yt=e("span",{class:"mr-1"},"Taxable",-1),gt={class:"flex items-center"},ht=e("span",{class:"mr-1"},"Recurring",-1),wt={class:"flex justify-end space-x-2 mt-4"},jt={__name:"AllowancesView",setup(s){const n=v(!1),d=v(!1),a=v({name:"",description:"",type:"transportation",amount_type:"fixed",amount:0,is_taxable:!0,is_recurring:!0,frequency:"per_payroll",eligibility_criteria:""}),o=v({id:null,name:"",description:"",type:"transportation",amount_type:"fixed",amount:0,is_taxable:!0,is_recurring:!0,frequency:"per_payroll",eligibility_criteria:""}),r=ee(),y=v([]);async function g(i={},t=!1){await r.fetchItems(i,t)}g({page:1,limit:10});const $=j(()=>{var i,t,l,B,q;return{total:((i=r.items)==null?void 0:i.total)||0,totalPages:((t=r.items)==null?void 0:t.totalPages)||1,currentPage:((l=r.items)==null?void 0:l.currentPage)||1,pageSize:((B=r.items)==null?void 0:B.pageSize)||10,data:((q=r.items)==null?void 0:q.data)||[]}}),m=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"type",label:"Type",sortable:!0,filterable:!0},{key:"amount_type",label:"Amount Type",sortable:!0,filterable:!0},{key:"amount",label:"Amount",sortable:!0,filterable:!0},{key:"frequency",label:"Frequency",sortable:!0,filterable:!0}],_=async i=>{await g(i,!0)},u=i=>{y.value=i},p=async i=>{r.isLoading=!0,o.value={id:i.id,name:i.name,description:i.description,type:i.type,amount_type:i.amount_type,amount:i.amount,is_taxable:i.is_taxable,is_recurring:i.is_recurring,frequency:i.frequency,eligibility_criteria:i.eligibility_criteria},d.value=!0,r.isLoading=!1},V=()=>{a.value={name:"",description:"",type:"transportation",amount_type:"fixed",amount:0,is_taxable:!0,is_recurring:!0,frequency:"per_payroll",eligibility_criteria:""},n.value=!0};async function T(){await r.createItem(a.value),r.error||(n.value=!1,await g({page:1,limit:10},!0))}async function D(){await r.updateItem(o.value.id,o.value),r.error||(d.value=!1,await g({page:1,limit:10},!0))}async function E(){if(y.value.length===0)return;if((await F.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete them!"})).isConfirmed){for(const t of y.value)if(await r.deleteItem(t),r.error)break;r.error||(y.value=[],await g({page:1,limit:10},!0),F.fire("Deleted!","The allowances have been deleted.","success"))}}return(i,t)=>(x(),P(R,null,{default:k(()=>[A(Q,null,{default:k(()=>[f(r).error?(x(),P(H,{key:0,icon:f(G),color:"danger"},{default:k(()=>[z(O(f(r).error),1)]),_:1},8,["icon"])):S("",!0),A(Y,{icon:f(W),title:"Allowances",main:""},{default:k(()=>[e("div",te,[A(N,{icon:f(X),color:"primary",label:"New Allowance",onClick:V},null,8,["icon"]),y.value.length?(x(),P(N,{key:0,icon:f(Z),color:"danger",label:"Delete",onClick:E},null,8,["icon"])):S("",!0)])]),_:1},8,["icon"]),A(K,{class:"mb-6"},{default:k(()=>[A(J,{columns:m,data:$.value,loading:f(r).isLoading,checkable:"",onQueryChange:_,onSelected:u,onEdit:p},null,8,["data","loading"])]),_:1})]),_:1}),n.value?(x(),M("div",le,[e("div",ae,[oe,e("div",se,[e("div",ne,[ie,c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.name=l),type:"text",class:"w-full border p-2 rounded"},null,512),[[b,a.value.name]])]),e("div",re,[ue,c(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.description=l),class:"w-full border p-2 rounded"},null,512),[[b,a.value.description]])]),e("div",null,[ce,c(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.type=l),class:"w-full border p-2 rounded"},ye,512),[[h,a.value.type]])]),e("div",null,[ge,c(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.amount_type=l),class:"w-full border p-2 rounded"},xe,512),[[h,a.value.amount_type]])]),e("div",null,[ke,c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.amount=l),type:"number",step:"0.01",class:"w-full border p-2 rounded"},null,512),[[b,a.value.amount,void 0,{number:!0}]])]),e("div",null,[Ae,c(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.frequency=l),class:"w-full border p-2 rounded"},Te,512),[[h,a.value.frequency]])]),e("div",Pe,[$e,c(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=l=>a.value.eligibility_criteria=l),class:"w-full border p-2 rounded"},null,512),[[b,a.value.eligibility_criteria]])]),e("div",Be,[e("label",qe,[Me,c(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.is_taxable=l),type:"checkbox",class:"mt-0"},null,512),[[U,a.value.is_taxable]])]),e("label",Fe,[Ne,c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>a.value.is_recurring=l),type:"checkbox",class:"mt-0"},null,512),[[U,a.value.is_recurring]])])])]),e("div",De,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[9]||(t[9]=l=>n.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:T}," Save ")])])])):S("",!0),d.value?(x(),M("div",Ee,[e("div",Le,[je,e("div",ze,[e("div",Oe,[Re,c(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>o.value.name=l),type:"text",class:"w-full border p-2 rounded"},null,512),[[b,o.value.name]])]),e("div",Qe,[He,c(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.description=l),class:"w-full border p-2 rounded"},null,512),[[b,o.value.description]])]),e("div",null,[Je,c(e("select",{"onUpdate:modelValue":t[12]||(t[12]=l=>o.value.type=l),class:"w-full border p-2 rounded"},tt,512),[[h,o.value.type]])]),e("div",null,[lt,c(e("select",{"onUpdate:modelValue":t[13]||(t[13]=l=>o.value.amount_type=l),class:"w-full border p-2 rounded"},st,512),[[h,o.value.amount_type]])]),e("div",null,[nt,c(e("input",{"onUpdate:modelValue":t[14]||(t[14]=l=>o.value.amount=l),type:"number",step:"0.01",class:"w-full border p-2 rounded"},null,512),[[b,o.value.amount,void 0,{number:!0}]])]),e("div",null,[it,c(e("select",{"onUpdate:modelValue":t[15]||(t[15]=l=>o.value.frequency=l),class:"w-full border p-2 rounded"},mt,512),[[h,o.value.frequency]])]),e("div",_t,[vt,c(e("textarea",{"onUpdate:modelValue":t[16]||(t[16]=l=>o.value.eligibility_criteria=l),class:"w-full border p-2 rounded"},null,512),[[b,o.value.eligibility_criteria]])]),e("div",bt,[e("label",ft,[yt,c(e("input",{"onUpdate:modelValue":t[17]||(t[17]=l=>o.value.is_taxable=l),type:"checkbox",class:"mt-0"},null,512),[[U,o.value.is_taxable]])]),e("label",gt,[ht,c(e("input",{"onUpdate:modelValue":t[18]||(t[18]=l=>o.value.is_recurring=l),type:"checkbox",class:"mt-0"},null,512),[[U,o.value.is_recurring]])])])]),e("div",wt,[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:t[19]||(t[19]=l=>d.value=!1)}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:D}," Update ")])])])):S("",!0)]),_:1}))}};export{jt as default};
