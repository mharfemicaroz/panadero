import{J as _,K as J,a as f,s as K,b as p,l as v,h as b,c as E,e as $,m as C,f as k,i as s,B,C as L,L as T,F as P,x as U,v as R,t as F,S as Y}from"./index.51562f92.js";import{A as S}from"./index.ecbb0c88.js";import{u as G}from"./category.ee73a307.js";import{p as H,u as W,v as X,c as Z}from"./mdi.50c7bbe5.js";import{_ as q}from"./NotificationBar.041f3c84.js";import{B as ee}from"./BaseTable.7226d914.js";import{_ as te}from"./CardBox.fbcc1594.js";import{_ as ae}from"./SectionTitleLineWithButton.887bdad5.js";import{_ as A}from"./BaseButton.ef1be83b.js";import"./BaseIcon.dfc7d1db.js";import"./BaseLevel.135e0538.js";import"./TableCheckboxCell.cdb4ab34.js";import"./BaseButtons.a7fb044c.js";import"./_plugin-vue_export-helper.c27b6911.js";const w={async list(t){return(await _.get(`${S}/subcategories`,{params:t})).data},async listByCategory(t,d){return(await _.get(`${S}/categories/${t}/subcategories`,{params:d})).data},async create(t){return(await _.post(`${S}/subcategories`,t)).data},async getById(t){return(await _.get(`${S}/subcategories/${t}`)).data},async updateById(t,d){return(await _.put(`${S}/subcategories/${t}`,d)).data},async delete(t){return(await _.delete(`${S}/subcategories/${t}`)).data}},se=J("subcategory",()=>{const t=f({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),d=f(null),a=f(!1),o=f(null),m=f(!1);return{items:t,item:d,isLoading:a,error:o,isLoaded:m,fetchItems:async(i={},l=!1)=>{var e;if(o.value=null,!(!l&&m.value))try{a.value=!0;const n=await w.list(i);Object.assign(t.value,{total:n.total||0,totalPages:n.totalPages||1,currentPage:i.page||1,pageSize:i.limit||10,data:n.data||[]}),m.value=!0}catch(n){o.value=((e=n==null?void 0:n.response)==null?void 0:e.message)||"Failed to fetch subcategories"}finally{a.value=!1}},fetchByCategory:async(i,l={},e=!1)=>{var n;if(o.value=null,!(!e&&m.value))try{a.value=!0;const y=await w.listByCategory(i,l);Object.assign(t.value,{total:y.total||0,totalPages:y.totalPages||1,currentPage:l.page||1,pageSize:l.limit||10,data:y.data||[]}),m.value=!0}catch(y){o.value=((n=y==null?void 0:y.response)==null?void 0:n.message)||"Failed to fetch subcategories by category"}finally{a.value=!1}},fetchById:async i=>{var l;o.value=null;try{a.value=!0;const e=await w.getById(i);d.value=e}catch(e){o.value=((l=e==null?void 0:e.response)==null?void 0:l.message)||"Failed to fetch subcategory"}finally{a.value=!1}},createItem:async i=>{var l;o.value=null;try{a.value=!0;const e=await w.create(i);t.value.data.push(e),t.value.total+=1}catch(e){o.value=((l=e==null?void 0:e.response)==null?void 0:l.message)||"Failed to create subcategory"}finally{a.value=!1}},updateItem:async(i,l)=>{var e;o.value=null;try{a.value=!0;const n=await w.updateById(i,l),y=t.value.data.findIndex(N=>N.id===i);y!==-1&&(t.value.data[y]=n)}catch(n){o.value=((e=n==null?void 0:n.response)==null?void 0:e.message)||"Failed to update subcategory"}finally{a.value=!1}},deleteItem:async i=>{var l;o.value=null;try{a.value=!0,await w.delete(i),t.value.data=t.value.data.filter(e=>e.id!==i),t.value.total-=1}catch(e){o.value=((l=e==null?void 0:e.response)==null?void 0:l.message)||"Failed to delete subcategory"}finally{a.value=!1}},resetStore:()=>{t.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},d.value=null,a.value=!1,o.value=null,m.value=!1}}}),oe={class:"flex items-center gap-2"},le={key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},ne={class:"bg-white p-6 rounded shadow-lg w-96"},ce=s("h2",{class:"text-xl mb-4"},"Add Subcategory",-1),re={class:"mb-4"},ue=s("label",{class:"block mb-1",for:"subcatName"},"Name",-1),ie={class:"mb-4"},de=s("label",{class:"block mb-1",for:"categorySelect"},"Category",-1),ge=["value"],me={key:2,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},ye={class:"bg-white p-6 rounded shadow-lg w-96"},fe=s("h2",{class:"text-xl mb-4"},"Edit Subcategory",-1),pe={class:"mb-4"},be=s("label",{class:"block mb-1",for:"editSubcatName"},"Name",-1),ve={class:"mb-4"},he=s("label",{class:"block mb-1",for:"editCategorySelect"},"Category",-1),_e=["value"],je={__name:"SubCategoryView",setup(t){const d=f(!1),a=f({name:"",categoryId:null}),o=f(!1),m=f({id:null,name:"",categoryId:null}),u=se(),I=G(),x=f([]);async function h(g={},c=!1){await u.fetchItems(g,c)}h({page:1,limit:5});const V=K(()=>{var g,c,r,j,z;return{total:((g=u.items)==null?void 0:g.total)||0,totalPages:((c=u.items)==null?void 0:c.totalPages)||1,currentPage:((r=u.items)==null?void 0:r.currentPage)||1,pageSize:((j=u.items)==null?void 0:j.pageSize)||5,data:((z=u.items)==null?void 0:z.data)||[]}}),D=[{key:"name",label:"Name",sortable:!0,filterable:!0},{key:"category",label:"Category",formatter:(g,c)=>c.category?c.category.name:"â€”"}],M=async g=>{await h(g,!0)},i=g=>{x.value=g},l=async g=>{await I.fetchItems(),m.value={id:g.id,name:g.name,categoryId:g.category?g.category.id:null},o.value=!0},e=async()=>{await I.fetchItems(),a.value={name:"",categoryId:null},d.value=!0};async function n(){await u.createItem({name:a.value.name,categoryId:a.value.categoryId}),u.error||(d.value=!1,await h({page:1,limit:5},!0))}async function y(){await u.updateItem(m.value.id,{name:m.value.name,categoryId:m.value.categoryId}),u.error||(o.value=!1,await h({page:1,limit:5},!0))}async function N(){if((await Y.fire({title:"Delete Subcategories?",text:"Are you sure you want to delete the selected subcategories?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Delete",cancelButtonText:"Cancel",confirmButtonColor:"#d33",cancelButtonColor:"#6c757d"})).isConfirmed){for(const c of x.value)if(await u.deleteItem(c),u.error)break;u.error||(x.value=[],await h({page:1,limit:5},!0))}}const O=()=>{d.value=!1},Q=()=>{o.value=!1};return(g,c)=>(p(),v(P,null,[b(u).error?(p(),E(q,{key:0,icon:b(H),color:"danger"},{default:$(()=>[R(F(b(u).error),1)]),_:1},8,["icon"])):C("",!0),k(ae,{icon:b(Z),title:"Subcategories",main:""},{default:$(()=>[s("div",oe,[k(A,{icon:b(W),color:"primary",label:"New Subcategory",onClick:e},null,8,["icon"]),x.value.length?(p(),E(A,{key:0,icon:b(X),color:"danger",label:"Delete",onClick:N},null,8,["icon"])):C("",!0)])]),_:1},8,["icon"]),k(te,{class:"mb-6"},{default:$(()=>[k(ee,{columns:D,data:V.value,loading:b(u).isLoading,checkable:"",onQueryChange:M,onSelected:i,onEdit:l},null,8,["data","loading"])]),_:1}),d.value?(p(),v("div",le,[s("div",ne,[ce,s("div",re,[ue,B(s("input",{id:"subcatName","onUpdate:modelValue":c[0]||(c[0]=r=>a.value.name=r),type:"text",class:"w-full border p-2 rounded"},null,512),[[L,a.value.name]])]),s("div",ie,[de,B(s("select",{id:"categorySelect","onUpdate:modelValue":c[1]||(c[1]=r=>a.value.categoryId=r),class:"w-full border p-2 rounded"},[(p(!0),v(P,null,U(b(I).items.data,r=>(p(),v("option",{key:r.id,value:r.id},F(r.name),9,ge))),128))],512),[[T,a.value.categoryId]])]),s("div",{class:"flex justify-end space-x-2"},[s("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:O}," Cancel "),s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:n}," Save ")])])])):C("",!0),o.value?(p(),v("div",me,[s("div",ye,[fe,s("div",pe,[be,B(s("input",{id:"editSubcatName","onUpdate:modelValue":c[2]||(c[2]=r=>m.value.name=r),type:"text",class:"w-full border p-2 rounded"},null,512),[[L,m.value.name]])]),s("div",ve,[he,B(s("select",{id:"editCategorySelect","onUpdate:modelValue":c[3]||(c[3]=r=>m.value.categoryId=r),class:"w-full border p-2 rounded"},[(p(!0),v(P,null,U(b(I).items.data,r=>(p(),v("option",{key:r.id,value:r.id},F(r.name),9,_e))),128))],512),[[T,m.value.categoryId]])]),s("div",{class:"flex justify-end space-x-2"},[s("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:Q}," Cancel "),s("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:y}," Update ")])])])):C("",!0)],64))}};export{je as default};
