import{J as C,K as fe,a as p,s as O,q as ye,b as r,c as V,e as D,f as L,h as v,v as q,t as y,m as w,i as e,l as _,B as h,L as U,F,x as P,C as S,S as M}from"./index.dc23916b.js";import{_ as be}from"./LayoutAuthenticatedX.cf159376.js";import{_ as ge}from"./SectionMain.2e7343f7.js";import{A as j}from"./index.07eee4a2.js";import{u as he}from"./employeeStore.f5e9650a.js";import{u as ke}from"./leaveTypeStore.5e182db4.js";import{_ as we}from"./NotificationBar.14b0a4e0.js";import{B as xe}from"./BaseTable.2f4a9c82.js";import{_ as qe}from"./CardBox.562f4397.js";import{_ as Re}from"./SectionTitleLineWithButton.67256f40.js";import{_ as A}from"./BaseButton.e90b5b96.js";import{p as Le,c as Ce,u as Se,v as je,z as Ie,q as $e,aw as Ee,h as Ve}from"./mdi.aa269c9f.js";import{V as G}from"./main.32a8828e.js";import"./darkMode.d89ef188.js";import"./BaseIcon.0daa2018.js";import"./FormControl.266f15c8.js";import"./FooterBar.29a6daac.js";import"./logo.c6f18b48.js";import"./BaseLevel.03004d95.js";import"./TableCheckboxCell.a1c98b2b.js";import"./BaseButtons.809b34dd.js";import"./_plugin-vue_export-helper.c27b6911.js";const B={async create(n){return(await C.post(`${j}/leaves/requests`,n)).data},async getById(n){return(await C.get(`${j}/leaves/requests/${n}`)).data},async updateById(n,u){return(await C.put(`${j}/leaves/requests/${n}`,u)).data},async delete(n){return(await C.delete(`${j}/leaves/requests/${n}`)).data},async list(n){return(await C.get(`${j}/leaves/requests`,{params:n})).data},async reject(n,u){return(await C.post(`${j}/leaves/requests/${n}/reject`,{reason:u})).data},async escalate(n,u){return(await C.post(`${j}/leaves/requests/${n}/escalate`,{approver_id:u})).data}},De=fe("leaveRequest",()=>{const n=p({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),u=p(!1),d=p(null),x=p(!1);return{items:n,isLoading:u,error:d,isLoaded:x,fetchItems:async(s={},c=!1)=>{var i;if(d.value=null,!(!c&&x.value))try{u.value=!0;const o=await B.list(s);Object.assign(n.value,{total:o.total||0,totalPages:o.totalPages||1,currentPage:s.page||1,pageSize:s.limit||10,data:o.data||[]}),x.value=!0}catch(o){d.value=((i=o==null?void 0:o.response)==null?void 0:i.message)||"Failed to fetch leave requests"}finally{u.value=!1}},createItem:async s=>{var c;d.value=null;try{u.value=!0;const i=await B.create(s);n.value.data.push(i),n.value.total+=1}catch(i){d.value=((c=i==null?void 0:i.response)==null?void 0:c.message)||"Failed to create leave request"}finally{u.value=!1}},updateItem:async(s,c)=>{var i;d.value=null;try{u.value=!0;const o=await B.updateById(s,c),m=n.value.data.findIndex(k=>k.id===s);m!==-1&&(n.value.data[m]=o)}catch(o){d.value=((i=o==null?void 0:o.response)==null?void 0:i.message)||"Failed to update leave request"}finally{u.value=!1}},deleteItem:async s=>{var c;d.value=null;try{u.value=!0,await B.delete(s),n.value.data=n.value.data.filter(i=>i.id!==s),n.value.total-=1}catch(i){d.value=((c=i==null?void 0:i.response)==null?void 0:c.message)||"Failed to delete leave request"}finally{u.value=!1}},rejectItem:async(s,c)=>{var i;d.value=null;try{u.value=!0;const o=await B.reject(s,c),m=n.value.data.findIndex(k=>k.id===s);m!==-1&&(n.value.data[m]=o)}catch(o){d.value=((i=o==null?void 0:o.response)==null?void 0:i.message)||"Failed to reject leave request"}finally{u.value=!1}},escalateItem:async(s,c)=>{var i;d.value=null;try{u.value=!0;const o=await B.escalate(s,c),m=n.value.data.findIndex(k=>k.id===s);m!==-1&&(n.value.data[m]=o)}catch(o){d.value=((i=o==null?void 0:o.response)==null?void 0:i.message)||"Failed to escalate leave request"}finally{u.value=!1}},resetStore:()=>{n.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},x.value=!1,u.value=!1,d.value=null}}}),Me={class:"flex items-center gap-2"},Ae={class:"flex gap-2"},Be={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},Te={class:"bg-white p-6 rounded shadow-lg w-[600px]"},Ue=e("h2",{class:"text-xl mb-4"},"Add Leave Request",-1),Fe={class:"grid grid-cols-1 gap-4"},Pe=e("label",{class:"block mb-1"},"Employee",-1),Ne=["disabled"],ze=e("option",{value:""},"Select Employee",-1),Oe=["value"],Qe=e("label",{class:"block mb-1"},"Leave Type",-1),Ye=["disabled"],Je=e("option",{value:""},"Select Leave Type",-1),Ke=["value"],Ge=e("label",{class:"block mb-1"},"Select Date Range",-1),He=e("label",{class:"block mb-1"},"Remarks",-1),We=e("label",{class:"block mb-1"},"Emergency Contact",-1),Xe=e("label",{class:"block mb-1"},"Attachment",-1),Ze={key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},et={class:"bg-white p-6 rounded shadow-lg w-[600px]"},tt=e("h2",{class:"text-xl mb-4"},"Edit Leave Request",-1),at={class:"grid grid-cols-1 gap-4"},lt=e("label",{class:"block mb-1"},"Employee",-1),st=["disabled"],ot=e("option",{value:""},"Select Employee",-1),nt=["value"],ut=e("label",{class:"block mb-1"},"Leave Type",-1),it=["disabled"],dt=e("option",{value:""},"Select Leave Type",-1),rt=["value"],ct=e("label",{class:"block mb-1"},"Select Date Range",-1),vt=e("label",{class:"block mb-1"},"Remarks",-1),pt=e("label",{class:"block mb-1"},"Emergency Contact",-1),mt=e("label",{class:"block mb-1"},"Attachment",-1),_t={key:2,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},ft={class:"bg-white p-6 rounded shadow-lg w-[600px]"},yt=e("h2",{class:"text-xl mb-4"},"Reject Leave Request",-1),bt={class:"grid grid-cols-1 gap-4"},gt=e("label",{class:"block mb-1"},"Reason",-1),ht={key:3,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},kt={class:"bg-white p-6 rounded shadow-lg w-[600px]"},wt=e("h2",{class:"text-xl mb-4"},"Escalate Leave Request",-1),xt={class:"grid grid-cols-1 gap-4"},qt=e("label",{class:"block mb-1"},"Approver",-1),Rt=e("option",{value:""},"Select Approver",-1),Lt=["value"],Ct={key:4,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},St={class:"bg-white p-6 rounded shadow-lg w-[600px]"},jt=e("h2",{class:"text-xl mb-4"},"Leave Request Details",-1),It={class:"grid grid-cols-1 gap-4"},$t=e("strong",null,"Employee:",-1),Et=e("strong",null,"Leave Type:",-1),Vt=e("strong",null,"Start Date:",-1),Dt=e("strong",null,"End Date:",-1),Mt=e("strong",null,"Status:",-1),At=e("strong",null,"Remarks:",-1),Bt=e("strong",null,"Emergency Contact:",-1),Tt=e("strong",null,"Attachment:",-1),ua={__name:"LeaveRequestView",setup(n){const u=p(!1),d=p(!1),x=p(!1),N=p(!1),T=p(!1),b=p({}),g=p({employee_id:"",leave_type_id:"",remarks:"",emergency_contact:"",attachment:""}),f=p({id:null,employee_id:"",leave_type_id:"",remarks:"",emergency_contact:"",attachment:""}),I=p({id:null,reason:""}),$=p({id:null,approver_id:""}),s=De(),c=he(),i=ke(),o=p([]),m=new Date,k=p([m,m]),z=p([m,m]),Q=O(()=>c.items.data.map(l=>({value:l.id,label:`${l.first_name} ${l.last_name}`}))),Y=O(()=>i.items.data.map(l=>({value:l.id,label:l.name}))),H=O(()=>c.items.data.filter(l=>l.is_manager).map(l=>({value:l.id,label:`${l.first_name} ${l.last_name}`})));ye(async()=>{await c.fetchItems({page:1,limit:1e3}),await i.fetchItems({page:1,limit:1e3}),await R({page:1,limit:5})});async function R(l={},a=!1){await s.fetchItems(l,a)}const J=O(()=>{var l,a,t,E,K;return{total:((l=s.items)==null?void 0:l.total)||0,totalPages:((a=s.items)==null?void 0:a.totalPages)||1,currentPage:((t=s.items)==null?void 0:t.currentPage)||1,pageSize:((E=s.items)==null?void 0:E.pageSize)||5,data:((K=s.items)==null?void 0:K.data)||[]}}),W=[{key:"employee_id",label:"Employee",sortable:!0,formatter:(l,a)=>a.employee?`${a.employee.first_name} ${a.employee.last_name}`:""},{key:"leave_type_id",label:"Leave Type",sortable:!0,formatter:(l,a)=>a.leaveType?a.leaveType.name:""},{key:"start_date",label:"Start Date",sortable:!0},{key:"end_date",label:"End Date",sortable:!0},{key:"status",label:"Status",sortable:!0,formatter:l=>({pending:"Pending",approved:"Approved",rejected:"Rejected"})[l]||l},{key:"remarks",label:"Remarks",sortable:!0}],X=async l=>{await R(l,!0)},Z=l=>{o.value=l},ee=l=>{f.value={id:l.id,employee_id:l.employee_id,leave_type_id:l.leave_type_id,remarks:l.remarks,emergency_contact:l.emergency_contact,attachment:l.attachment},z.value=[new Date(l.start_date),new Date(l.end_date)],d.value=!0},te=l=>{const a=J.value.data.find(t=>t.id===l);a&&(b.value=a,N.value=!0)},ae=()=>{N.value=!1},le=()=>{g.value={employee_id:"",leave_type_id:"",remarks:"",emergency_contact:"",attachment:""},k.value=[m,m],u.value=!0};async function se(){const[l,a]=k.value,t={...g.value,start_date:l,end_date:a};await s.createItem(t),s.error||(u.value=!1,await R({page:1,limit:5},!0))}async function oe(){const[l,a]=z.value,t={...f.value,start_date:l,end_date:a};await s.updateItem(f.value.id,t),s.error||(d.value=!1,await R({page:1,limit:5},!0))}async function ne(){if(o.value.length===0)return;if((await M.fire({title:"Are you sure?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete them!"})).isConfirmed){for(const a of o.value)if(await s.deleteItem(a),s.error)break;s.error||(o.value=[],await R({page:1,limit:5},!0),M.fire("Deleted!","The leave requests have been deleted.","success"))}}async function ue(l){(await M.fire({title:"Approve Leave Request?",text:"Are you sure you want to approve this leave request?",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, approve it!"})).isConfirmed&&(await s.updateItem(l,{status:"approved"}),s.error||(await R({page:1,limit:5},!0),M.fire("Approved!","The leave request has been approved.","success")))}const ie=l=>{I.value.id=l,x.value=!0};async function de(){await s.rejectItem(I.value.id,I.value.reason),s.error||(x.value=!1,await R({page:1,limit:5},!0),M.fire("Rejected!","The leave request has been rejected.","success"))}const re=l=>{$.value.id=l,T.value=!0};async function ce(){await s.escalateItem($.value.id,$.value.approver_id),s.error||(T.value=!1,await R({page:1,limit:5},!0),M.fire("Escalated!","The leave request has been escalated.","success"))}const ve=()=>{u.value=!1},pe=()=>{d.value=!1},me=()=>{x.value=!1},_e=()=>{T.value=!1};return(l,a)=>(r(),V(be,null,{default:D(()=>[L(ge,null,{default:D(()=>[v(s).error?(r(),V(we,{key:0,icon:v(Le),color:"danger"},{default:D(()=>[q(y(v(s).error),1)]),_:1},8,["icon"])):w("",!0),L(Re,{icon:v(Ce),title:"Leave Requests",main:""},{default:D(()=>[e("div",Me,[L(A,{icon:v(Se),color:"primary",label:"New Leave Request",onClick:le},null,8,["icon"]),o.value.length?(r(),V(A,{key:0,icon:v(je),color:"danger",label:"Delete",onClick:ne},null,8,["icon"])):w("",!0)])]),_:1},8,["icon"]),L(qe,{class:"mb-6"},{default:D(()=>[L(xe,{columns:W,data:J.value,loading:v(s).isLoading,checkable:"",onQueryChange:X,onSelected:Z,onEdit:ee},{"cell-actions":D(({row:t})=>[e("div",Ae,[t.status==="pending"?(r(),V(A,{key:0,icon:v(Ie),color:"success",small:"",onClick:E=>ue(t.id)},null,8,["icon","onClick"])):w("",!0),t.status==="pending"?(r(),V(A,{key:1,icon:v($e),color:"danger",small:"",onClick:E=>ie(t.id)},null,8,["icon","onClick"])):w("",!0),t.status==="pending"||t.status==="rejected"?(r(),V(A,{key:2,icon:v(Ee),color:"warning",small:"",onClick:E=>re(t.id)},null,8,["icon","onClick"])):w("",!0),L(A,{icon:v(Ve),color:"info",small:"",onClick:E=>te(t.id)},null,8,["icon","onClick"])])]),_:1},8,["data","loading"])]),_:1})]),_:1}),u.value?(r(),_("div",Be,[e("div",Te,[Ue,e("div",Fe,[e("div",null,[Pe,h(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>g.value.employee_id=t),class:"w-full border p-2 rounded",disabled:v(c).isLoading},[ze,(r(!0),_(F,null,P(Q.value,t=>(r(),_("option",{key:t.value,value:t.value},y(t.label),9,Oe))),128))],8,Ne),[[U,g.value.employee_id]])]),e("div",null,[Qe,h(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>g.value.leave_type_id=t),class:"w-full border p-2 rounded",disabled:v(i).isLoading},[Je,(r(!0),_(F,null,P(Y.value,t=>(r(),_("option",{key:t.value,value:t.value},y(t.label),9,Ke))),128))],8,Ye),[[U,g.value.leave_type_id]])]),e("div",null,[Ge,L(v(G),{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=t=>k.value=t),range:"","multi-calendars":"",format:"yyyy-MM-dd","input-class":"mt-1 block w-full rounded border-gray-300 shadow-sm"},null,8,["modelValue"])]),e("div",null,[He,h(e("textarea",{"onUpdate:modelValue":a[3]||(a[3]=t=>g.value.remarks=t),class:"w-full border p-2 rounded"},null,512),[[S,g.value.remarks]])]),e("div",null,[We,h(e("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>g.value.emergency_contact=t),type:"text",class:"w-full border p-2 rounded"},null,512),[[S,g.value.emergency_contact]])]),e("div",null,[Xe,h(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>g.value.attachment=t),type:"text",class:"w-full border p-2 rounded"},null,512),[[S,g.value.attachment]])])]),e("div",{class:"flex justify-end space-x-2 mt-4"},[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:ve}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:se}," Save ")])])])):w("",!0),d.value?(r(),_("div",Ze,[e("div",et,[tt,e("div",at,[e("div",null,[lt,h(e("select",{"onUpdate:modelValue":a[6]||(a[6]=t=>f.value.employee_id=t),class:"w-full border p-2 rounded",disabled:v(c).isLoading},[ot,(r(!0),_(F,null,P(Q.value,t=>(r(),_("option",{key:t.value,value:t.value},y(t.label),9,nt))),128))],8,st),[[U,f.value.employee_id]])]),e("div",null,[ut,h(e("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>f.value.leave_type_id=t),class:"w-full border p-2 rounded",disabled:v(i).isLoading},[dt,(r(!0),_(F,null,P(Y.value,t=>(r(),_("option",{key:t.value,value:t.value},y(t.label),9,rt))),128))],8,it),[[U,f.value.leave_type_id]])]),e("div",null,[ct,L(v(G),{modelValue:z.value,"onUpdate:modelValue":a[8]||(a[8]=t=>z.value=t),range:"","multi-calendars":"",format:"yyyy-MM-dd","input-class":"mt-1 block w-full rounded border-gray-300 shadow-sm"},null,8,["modelValue"])]),e("div",null,[vt,h(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=t=>f.value.remarks=t),class:"w-full border p-2 rounded"},null,512),[[S,f.value.remarks]])]),e("div",null,[pt,h(e("input",{"onUpdate:modelValue":a[10]||(a[10]=t=>f.value.emergency_contact=t),type:"text",class:"w-full border p-2 rounded"},null,512),[[S,f.value.emergency_contact]])]),e("div",null,[mt,h(e("input",{"onUpdate:modelValue":a[11]||(a[11]=t=>f.value.attachment=t),type:"text",class:"w-full border p-2 rounded"},null,512),[[S,f.value.attachment]])])]),e("div",{class:"flex justify-end space-x-2 mt-4"},[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:pe}," Cancel "),e("button",{class:"px-4 py-2 bg-blue-600 text-white rounded",onClick:oe}," Update ")])])])):w("",!0),x.value?(r(),_("div",_t,[e("div",ft,[yt,e("div",bt,[e("div",null,[gt,h(e("textarea",{"onUpdate:modelValue":a[12]||(a[12]=t=>I.value.reason=t),class:"w-full border p-2 rounded",placeholder:"Enter rejection reason"},null,512),[[S,I.value.reason]])])]),e("div",{class:"flex justify-end space-x-2 mt-4"},[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:me},"Cancel"),e("button",{class:"px-4 py-2 bg-red-600 text-white rounded",onClick:de}," Reject ")])])])):w("",!0),T.value?(r(),_("div",ht,[e("div",kt,[wt,e("div",xt,[e("div",null,[qt,h(e("select",{"onUpdate:modelValue":a[13]||(a[13]=t=>$.value.approver_id=t),class:"w-full border p-2 rounded"},[Rt,(r(!0),_(F,null,P(H.value,t=>(r(),_("option",{key:t.value,value:t.value},y(t.label),9,Lt))),128))],512),[[U,$.value.approver_id]])])]),e("div",{class:"flex justify-end space-x-2 mt-4"},[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:_e},"Cancel"),e("button",{class:"px-4 py-2 bg-yellow-600 text-white rounded",onClick:ce}," Escalate ")])])])):w("",!0),N.value?(r(),_("div",Ct,[e("div",St,[jt,e("div",It,[e("div",null,[$t,q(" "+y(b.value.employee?`${b.value.employee.first_name} ${b.value.employee.last_name}`:"N/A"),1)]),e("div",null,[Et,q(" "+y(b.value.leaveType?b.value.leaveType.name:"N/A"),1)]),e("div",null,[Vt,q(" "+y(b.value.start_date),1)]),e("div",null,[Dt,q(" "+y(b.value.end_date),1)]),e("div",null,[Mt,q(" "+y(b.value.status),1)]),e("div",null,[At,q(" "+y(b.value.remarks),1)]),e("div",null,[Bt,q(" "+y(b.value.emergency_contact),1)]),e("div",null,[Tt,q(" "+y(b.value.attachment),1)])]),e("div",{class:"flex justify-end space-x-2 mt-4"},[e("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:ae}," Close ")])])])):w("",!0)]),_:1}))}};export{ua as default};
