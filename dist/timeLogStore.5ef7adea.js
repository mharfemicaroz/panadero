import{J as i,K as f,a as v}from"./index.dc23916b.js";import{A as u}from"./index.07eee4a2.js";const c={async create(e){return(await i.post(`${u}/timelogs`,e)).data},async getById(e){return(await i.get(`${u}/timelogs/${e}`)).data},async updateById(e,a){return(await i.put(`${u}/timelogs/${e}`,a)).data},async delete(e){return(await i.delete(`${u}/timelogs/${e}`)).data},async list(e){return(await i.get(`${u}/timelogs`,{params:e})).data},async recordTimeLog(e,a){return(await i.post(`${u}/timelogs/record/${e}`,a)).data},async getDailyLogs(e,a){return(await i.get(`${u}/timelogs/daily/${e}`,{params:a})).data},async faceVerifyTimeLog(e,a){return(await i.post(`${u}/timelogs/face-verify`,{base64Image:e,type:a})).data}},P=f("timeLog",()=>{const e=v({total:0,totalPages:1,currentPage:1,pageSize:10,data:[]}),a=v(!1),l=v(null),g=v(!1);return{items:e,isLoading:a,error:l,isLoaded:g,fetchItems:async(n={},r=!1)=>{var t;if(l.value=null,!(!r&&g.value))try{a.value=!0;const s=await c.list(n);Object.assign(e.value,{total:s.total||0,totalPages:s.totalPages||1,currentPage:n.page||1,pageSize:n.limit||10,data:s.data||[]}),g.value=!0}catch(s){l.value=((t=s==null?void 0:s.response)==null?void 0:t.message)||"Failed to fetch time logs"}finally{a.value=!1}},createItem:async n=>{var r;l.value=null;try{a.value=!0;const t=await c.create(n);e.value.data.push(t),e.value.total+=1}catch(t){l.value=((r=t==null?void 0:t.response)==null?void 0:r.message)||"Failed to create time log"}finally{a.value=!1}},updateItem:async(n,r)=>{var t;l.value=null;try{a.value=!0;const s=await c.updateById(n,r),o=e.value.data.findIndex(d=>d.id===n);o!==-1&&(e.value.data[o]=s)}catch(s){l.value=((t=s==null?void 0:s.response)==null?void 0:t.message)||"Failed to update time log"}finally{a.value=!1}},deleteItem:async n=>{var r;l.value=null;try{a.value=!0,await c.delete(n),e.value.data=e.value.data.filter(t=>t.id!==n),e.value.total-=1}catch(t){l.value=((r=t==null?void 0:t.response)==null?void 0:r.message)||"Failed to delete time log"}finally{a.value=!1}},recordTimeLog:async(n,{type:r,base64Image:t,picturePath:s})=>{var o,d;l.value=null;try{return a.value=!0,await c.recordTimeLog(n,{type:r,base64Image:t,picturePath:s})}catch(p){l.value=((d=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:d.message)||"Failed to record time log"}finally{a.value=!1}},faceVerifyTimeLog:async(n,r)=>{var t,s;l.value=null;try{return a.value=!0,await c.faceVerifyTimeLog(n,r)}catch(o){l.value=((s=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to verify face"}finally{a.value=!1}},getDailyLogs:async(n,r={},t=!1)=>{var s;if(l.value=null,!(!t&&g.value))try{a.value=!0;const o=await c.getDailyLogs(n,r);e.value.total=o.total||0,e.value.totalPages=o.totalPages||1,e.value.currentPage=r.page||1,e.value.pageSize=r.limit||10,e.value.data=o.data||[],g.value=!0}catch(o){console.error(o),l.value=((s=o==null?void 0:o.response)==null?void 0:s.message)||"Failed to fetch daily logs"}finally{a.value=!1}},resetStore:()=>{e.value={total:0,totalPages:1,currentPage:1,pageSize:10,data:[]},g.value=!1,a.value=!1,l.value=null}}});export{P as u};
