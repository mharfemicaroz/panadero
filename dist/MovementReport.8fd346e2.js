import{a as b,q as N,s as u,b as d,c as k,e as _,i as o,h as r,v as Q,t as D,m as W,f as l,B as A,L,l as x,x as U,F as E}from"./index.a2c9f28c.js";import{_ as P}from"./LayoutAuthenticatedX.d58fd7d8.js";import{_ as z}from"./NotificationBar.caa84e93.js";import{B as S}from"./BaseTable.a063d648.js";import{_ as C}from"./CardBox.25a3dc7a.js";import{_ as F}from"./SectionTitleLineWithButton.39476921.js";import{_ as Y}from"./BaseButton.b8e12a74.js";import{V as j}from"./main.be0db63c.js";import{u as O}from"./inventory.97e4a13c.js";import{u as G}from"./warehouse.0c6d3805.js";import"./mdi.aa269c9f.js";import"./darkMode.b88882a1.js";import"./BaseIcon.ad3a4017.js";import"./FormControl.2759acc3.js";import"./FooterBar.948c11c8.js";import"./logo.c6f18b48.js";import"./BaseLevel.e0eed931.js";import"./TableCheckboxCell.8ab5003b.js";import"./BaseButtons.e7208c74.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./index.77c7a69c.js";const H={class:"p-4"},J={class:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded shadow-sm"},K={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},X=o("label",{class:"block text-sm font-medium text-gray-700"},"Select Date Range",-1),Z=o("label",{class:"block text-sm font-medium text-gray-700"},"Select Warehouse",-1),tt=o("option",{value:""},"All Warehouses",-1),et=["value"],at={class:"flex items-end"},Ct={__name:"MovementReport",setup(ot){const s=O(),f=G(),n=b([new Date,new Date]),m=b("");function w(t){const e=new Date(t),a=e.getFullYear(),i=(e.getMonth()+1).toString().padStart(2,"0"),c=e.getDate().toString().padStart(2,"0");return`${a}-${i}-${c}T00:00:00`}function M(t){const e=new Date(t),a=e.getFullYear(),i=(e.getMonth()+1).toString().padStart(2,"0"),c=e.getDate().toString().padStart(2,"0");return`${a}-${i}-${c}T23:59:59`}async function p(t={},e=!1){await s.fetchItems(t,e)}async function T(){await f.fetchAll({},!0)}N(()=>{T(),p({page:1,limit:10},!0)});const y=u(()=>s.items.data.map(t=>{const e=(t.stock_movements||[]).reduce((v,h)=>h.type==="IN"?v+h.quantity_change:v,0);if(e<=0)return null;const a=t.item?parseFloat(t.item.cost):0,i=t.item?parseFloat(t.item.price):0,c=t.item&&t.item.category?t.item.category.name:"Uncategorized";return{item:t.item?t.item.name:"",category:c,current_cost:a,quantity:e,total_cost:a*e,total_price:i*e}}).filter(t=>t!==null)),$=u(()=>({total:y.value.length,data:y.value.map(t=>({...t,current_cost:t.current_cost.toFixed(2),total_cost:t.total_cost.toFixed(2),total_price:t.total_price.toFixed(2)}))})),g=u(()=>{const t={};return y.value.forEach(e=>{const a=e.category||"Uncategorized";t[a]||(t[a]={category:a,total_quantity:0,total_cost:0,total_price:0}),t[a].total_quantity+=e.quantity,t[a].total_cost+=e.total_cost,t[a].total_price+=e.total_price}),Object.values(t)}),q=u(()=>({total:g.value.length,data:g.value.map(t=>({category:t.category,total_quantity:t.total_quantity,total_cost:t.total_cost.toFixed(2),total_price:t.total_price.toFixed(2)}))})),V=[{key:"item",label:"Item"},{key:"current_cost",label:"Current Cost"},{key:"quantity",label:"Quantity"},{key:"total_cost",label:"Total Cost"},{key:"total_price",label:"Total Price"}],B=[{key:"category",label:"Category"},{key:"total_quantity",label:"Total Quantity"},{key:"total_cost",label:"Total Cost"},{key:"total_price",label:"Total Price"}],I=async()=>{let t="",e="";n.value&&n.value.length===2&&(t=w(n.value[0]),e=M(n.value[1]));const a={};t&&(a["filters[stock_movements.created_at][gte]"]=t),e&&(a["filters[stock_movements.created_at][lte]"]=e),m.value&&(a["filters[warehouse_id]"]=m.value),await p({...a,page:1,limit:10},!0)},R=async t=>{await p(t,!0)};return(t,e)=>(d(),k(P,null,{default:_(()=>[o("div",H,[r(s).error?(d(),k(z,{key:0,color:"danger"},{default:_(()=>[Q(D(r(s).error),1)]),_:1})):W("",!0),l(F,{title:"Item Added Report",main:""}),o("div",J,[o("div",K,[o("div",null,[X,l(r(j),{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),range:"","multi-calendars":"",format:"yyyy-MM-dd","input-class":"mt-1 block w-full rounded border-gray-300 shadow-sm"},null,8,["modelValue"])]),o("div",null,[Z,A(o("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),class:"mt-1 block w-full rounded border-gray-300 shadow-sm"},[tt,(d(!0),x(E,null,U(r(f).warehouses,a=>(d(),x("option",{key:a.id,value:a.id},D(a.name),9,et))),128))],512),[[L,m.value]])]),o("div",at,[l(Y,{label:"Filter",color:"blue",class:"px-4 py-2",onClick:I})])])]),l(C,{class:"mb-6"},{default:_(()=>[l(S,{columns:V,data:$.value,loading:r(s).isLoading,"show-action":!1,onQueryChange:R},null,8,["data","loading"])]),_:1}),l(F,{title:"Categories Added Report",main:""}),l(C,{class:"mb-6"},{default:_(()=>[l(S,{columns:B,data:q.value,loading:r(s).isLoading,"show-action":!1},null,8,["data","loading"])]),_:1})])]),_:1}))}};export{Ct as default};
