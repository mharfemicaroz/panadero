import{_ as I}from"./LayoutAuthenticatedX.d58fd7d8.js";import{_ as j}from"./SectionMain.8435c1f0.js";import{u as L}from"./sale.19acb1de.js";import{u as N}from"./user.622b5b9d.js";import{u as Y}from"./branch.31058824.js";import{u as q}from"./warehouse.0c6d3805.js";import{_ as z}from"./SalesFilters.cdb3cd9e.js";import{_ as E}from"./NotificationBar.caa84e93.js";import{B as O}from"./BaseTable.a063d648.js";import"./BaseIcon.ad3a4017.js";import{_ as Q}from"./CardBox.25a3dc7a.js";import{_ as U}from"./SectionTitleLineWithButton.39476921.js";import{p as G,c as H,h as J}from"./mdi.aa269c9f.js";import{a as b,q as K,s as X,b as _,l as p,f as h,e as f,i as a,v as y,t as d,F as S,x as Z,m as k,h as u,c as ee}from"./index.a2c9f28c.js";import"./darkMode.b88882a1.js";import"./FormControl.2759acc3.js";import"./FooterBar.948c11c8.js";import"./logo.c6f18b48.js";import"./BaseLevel.e0eed931.js";import"./index.77c7a69c.js";import"./BaseButton.b8e12a74.js";import"./main.be0db63c.js";import"./TableCheckboxCell.8ab5003b.js";import"./BaseButtons.e7208c74.js";import"./_plugin-vue_export-helper.c27b6911.js";const te=["onClick"],se={style:{width:"18px",height:"18px"},viewBox:"0 0 24 24"},ae=["d"],oe={key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"},ne={class:"bg-white p-6 rounded shadow-lg w-[400px]"},le=a("h2",{class:"text-xl mb-4 text-center"},"Sales Receipt",-1),re={class:"border-t border-b py-4 mb-4"},ce={class:"mb-2"},ie=a("strong",null,"Transaction #:",-1),de={class:"mb-2"},ue=a("strong",null,"Date:",-1),me={class:"mb-2"},_e=a("strong",null,"Cashier:",-1),he={class:"mb-4"},pe=a("h3",{class:"font-bold mb-2"},"Items:",-1),fe={class:"flex justify-between"},ye={class:"border-t pt-4"},ge={class:"flex justify-between font-bold"},be=a("span",null,"Total Amount:",-1),Qe={__name:"SalesView",setup(we){const g=b(!1),i=b(null),c=L(),w=N(),v=Y(),D=q();w.fetchAll(),v.fetchAll(),D.fetchAll();async function P(e={},s=!0){await c.fetchItems(e,s)}K(()=>{const e=new Date;x({selectedPeriod:"all_day",allDayRange:[e,e],monthlyYear:e.getFullYear(),monthlyMonth:e.getMonth()+1,selectedCashier:"",selectedBranch:"",selectedWarehouse:""})});const C=b("all_day"),l=e=>{const s=new Date(e),t=""+(s.getMonth()+1),o=""+s.getDate();return[s.getFullYear(),t.padStart(2,"0"),o.padStart(2,"0")].join("-")},R=()=>{const e=new Date,s=e.getDay()===0?7:e.getDay(),t=new Date(e);t.setDate(e.getDate()-s+1);const o=new Date(t);return o.setDate(t.getDate()+6),{start:l(t),end:l(o)}},B=()=>{const e=new Date,s=e.getDay()===0?7:e.getDay(),t=new Date(e);t.setDate(e.getDate()-s);const o=new Date(t);return o.setDate(t.getDate()-6),{start:l(o),end:l(t)}},x=async e=>{let s,t;const o=new Date;if(e.selectedPeriod==="all_day")e.allDayRange&&e.allDayRange.length===2&&(s=l(e.allDayRange[0])+"T00:00:00",t=l(e.allDayRange[1])+"T23:59:59");else if(e.selectedPeriod==="monthly"){const r=parseInt(e.monthlyYear),m=parseInt(e.monthlyMonth),W=new Date(r,m-1,1),A=new Date(r,m,0);s=l(W),t=l(A)}else if(e.selectedPeriod==="this_week"){const{start:r,end:m}=R();s=r,t=m}else if(e.selectedPeriod==="last_week"){const{start:r,end:m}=B();s=r,t=m}else if(e.selectedPeriod==="last_7_days"){const r=new Date(o);r.setDate(o.getDate()-6),s=l(r),t=l(o)}else if(e.selectedPeriod==="last_30_days"){const r=new Date(o);r.setDate(o.getDate()-29),s=l(r),t=l(o)}let n={page:1,limit:10};(s||t)&&(n.filters={},s&&(n.filters.start_date=s),t&&(n.filters.end_date=t)),e.selectedCashier&&(n.filters=n.filters||{},n.filters.user_id=e.selectedCashier),e.selectedBranch&&(n.filters=n.filters||{},n.filters.branch_id=e.selectedBranch),e.selectedWarehouse&&(n.filters=n.filters||{},n.filters.warehouse_id=e.selectedWarehouse),C.value=e.selectedPeriod,await c.fetchItems(n,!0)},F=async e=>{const s={page:e.page||1,limit:e.limit||10,filters:{}};await P(s,!0)},M=X(()=>{var e,s,t,o,n;return{total:((e=c.items)==null?void 0:e.total)||0,totalPages:((s=c.items)==null?void 0:s.totalPages)||1,currentPage:((t=c.items)==null?void 0:t.currentPage)||1,pageSize:((o=c.items)==null?void 0:o.pageSize)||10,data:((n=c.items)==null?void 0:n.data)||[]}}),T=[{key:"id",label:"Transaction #",sortable:!0},{key:"created_at",label:"Date & Time",sortable:!0,formatter:e=>new Date(e).toLocaleString()},{key:"user",label:"Cashier",formatter:(e,s)=>s.user?`${s.user.first_name} ${s.user.last_name}`:""},{key:"total_amount",label:"Amount",sortable:!0,formatter:e=>`₱${parseFloat(e).toFixed(2)}`}],$=async e=>{i.value=e,g.value=!0},V=()=>{g.value=!1,i.value=null};return(e,s)=>(_(),p(S,null,[h(I,null,{default:f(()=>[h(j,null,{default:f(()=>[u(c).error?(_(),ee(E,{key:0,icon:u(G),color:"danger"},{default:f(()=>[y(d(u(c).error),1)]),_:1},8,["icon"])):k("",!0),h(U,{icon:u(H),title:"Receipts",main:""},null,8,["icon"]),h(z,{"user-store":u(w),"branch-store":u(v),"warehouse-store":u(D),onFilter:x},null,8,["user-store","branch-store","warehouse-store"]),h(Q,{class:"mb-6"},{default:f(()=>[h(O,{columns:T,data:M.value,loading:u(c).isLoading,checkable:!1,showAction:!0,onQueryChange:F},{"cell-actions":f(({row:t})=>[a("button",{class:"text-blue-600 underline",onClick:o=>$(t),title:"View Shift Report"},[(_(),p("svg",se,[a("path",{d:u(J)},null,8,ae)]))],8,te)]),_:1},8,["data","loading"])]),_:1})]),_:1})]),_:1}),g.value&&i.value?(_(),p("div",oe,[a("div",ne,[le,a("div",re,[a("p",ce,[ie,y(" "+d(i.value.id),1)]),a("p",de,[ue,y(" "+d(new Date(i.value.created_at).toLocaleString()),1)]),a("p",me,[_e,y(" "+d(i.value.user.first_name)+" "+d(i.value.user.last_name),1)])]),a("div",he,[pe,(_(!0),p(S,null,Z(i.value.saleItems,t=>(_(),p("div",{key:t.id,class:"mb-2"},[a("div",fe,[a("span",null,d(t.item.name)+" x "+d(t.quantity),1),a("span",null,"₱"+d(parseFloat(t.total).toFixed(2)),1)])]))),128))]),a("div",ye,[a("div",ge,[be,a("span",null,"₱"+d(parseFloat(i.value.total_amount).toFixed(2)),1)])]),a("div",{class:"flex justify-end mt-4"},[a("button",{class:"px-4 py-2 bg-gray-200 rounded",onClick:V},"Close")])])])):k("",!0)],64))}};export{Qe as default};
